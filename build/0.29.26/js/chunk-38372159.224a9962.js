(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38372159"],{"055b":function(t,e,r){"use strict";var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"d-flex flex-nowrap",staticStyle:{"overflow-x":"auto"}},[e("router-link",{staticClass:"btn mr-5 mb-15",class:{"btn-secondary":!t.isMatch("/purchase/request")},attrs:{to:"/purchase/request","active-class":"btn-primary"}},[e("span",[t._v(t._s(t._f("uppercase")(t.$t("purchase request"))))])]),e("router-link",{staticClass:"btn mr-5 mb-15",class:{"btn-secondary":!t.isMatch("/purchase/order")},attrs:{to:"/purchase/order","active-class":"btn-primary"}},[e("span",[t._v(t._s(t._f("uppercase")(t.$t("purchase order"))))])]),e("router-link",{staticClass:"btn mr-5 mb-15",class:{"btn-secondary":!t.isMatch("/purchase/down-payment")},attrs:{to:"/purchase/down-payment","active-class":"btn-primary"}},[e("span",[t._v(t._s(t._f("uppercase")(t.$t("down payment"))))])]),e("router-link",{staticClass:"btn mr-5 mb-15",class:{"btn-secondary":!t.isMatch("/purchase/receive")},attrs:{to:"/purchase/receive","active-class":"btn-primary"}},[e("span",[t._v(t._s(t._f("uppercase")(t.$t("purchase receive"))))])]),e("router-link",{staticClass:"btn mr-5 mb-15",class:{"btn-secondary":!t.isMatch("/purchase/invoice")},attrs:{to:"/purchase/invoice","active-class":"btn-primary"}},[e("span",[t._v(t._s(t._f("uppercase")(t.$t("purchase invoice"))))])]),e("router-link",{staticClass:"btn mr-5 mb-15",class:{"btn-secondary":!t.isMatch("/purchase/payment-order")},attrs:{to:"/purchase/payment-order","active-class":"btn-primary"}},[e("span",[t._v(t._s(t._f("uppercase")(t.$t("payment order"))))])])],1)},a=[],o={data:function(){return{path:this.$route.path}},methods:{isMatch:function(t){return this.path.substring(0,t.length)==t}}},i=o,n=r("2877"),c=Object(n["a"])(i,s,a,!1,null,null,null);e["a"]=c.exports},"7c81":function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t._self._c;return e("div",[e("breadcrumb",[e("breadcrumb-purchase"),e("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"purchase.request.index"}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("purchase request")))+" ")]),e("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"purchase.request.show",params:{id:t.id}}}},[t._v(" "+t._s(t._f("uppercase")(t.purchaseRequest.form.number))+" ")]),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")(t.$t("edit"))))])],1),e("purchase-menu"),e("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("div",{staticClass:"row"},[e("p-block",{attrs:{header:!1}},[e("p-block-inner",{attrs:{"is-loading":t.isLoading}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("h4",[t._v(t._s(t._f("uppercase")(t.$t("purchase request"))))]),e("table",{staticClass:"table table-sm table-bordered"},[e("tr",[e("td",{staticClass:"font-weight-bold",attrs:{width:"150px"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("form number")))+" ")]),e("td",[t._v(t._s(t.purchaseRequest.form.number))])]),e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("required date")))+" ")]),e("td",[e("p-date-picker",{attrs:{id:"required-date",name:"required-date",label:t.$t("required date"),errors:t.form.errors.get("required_date")},on:{errors:function(e){return t.form.errors.set("required_date",null)}},model:{value:t.form.required_date,callback:function(e){t.$set(t.form,"required_date",e)},expression:"form.required_date"}})],1)])])]),e("div",{staticClass:"col-sm-6 text-right"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.authUser.tenant_name))+" ")]),t.form.branch?[t._v(" "+t._s(t._f("uppercase")(t.form.branch.address))),t.form.branch.address?e("br"):t._e(),t._v(" "+t._s(t._f("uppercase")(t.form.branch.phone))),t.form.branch.phone?e("br"):t._e()]:t._e()],2)]),e("hr"),e("point-table",{staticClass:"mt-20"},[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",{staticClass:"text-center"},[t._v(" # ")]),e("th",[t._v("Item")]),e("th",[t._v("Notes")]),e("th",[t._v("Quantity")]),e("th",[e("button",{staticClass:"btn btn-sm btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){return t.toggleMore()}}},[e("i",{staticClass:"fa fa-ellipsis-h"})])])]),t._l(t.form.items,(function(r,s){return[e("tr",{key:s,attrs:{slot:"p-body"},slot:"p-body"},[e("th",{staticClass:"text-center"},[t._v(" "+t._s(s+1)+" ")]),e("td",[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.item.open(s)}}},[t._v(" "+t._s(t._f("uppercase")(r.item_name||t.$t("select")))+" ")])]),e("td",[e("p-form-input",{attrs:{id:"notes-"+s,name:"notes-"+s,disabled:null==r.item_id},model:{value:r.notes,callback:function(e){t.$set(r,"notes",e)},expression:"row.notes"}})],1),e("td",[e("p-quantity",{attrs:{id:"quantity-"+s,name:"quantity-"+s,disabled:null==r.item_id,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter}},on:{choosen:function(e){return t.chooseUnit(e,r)}},model:{value:r.quantity,callback:function(e){t.$set(r,"quantity",e)},expression:"row.quantity"}})],1),e("td",[t.isSaving?t._e():e("button",{staticClass:"btn btn-sm btn-outline-secondary",attrs:{type:"button"},on:{click:function(t){r.more=!r.more}}},[e("i",{staticClass:"fa fa-ellipsis-h"})])])]),r.more&&r.item_id?[e("tr",{key:"ext-"+s,staticClass:"bg-gray-light",attrs:{slot:"p-body"},slot:"p-body"},[e("th",{staticClass:"bg-gray-light"}),e("td",{attrs:{colspan:"4"}},[e("p-form-row",{attrs:{id:"allocation",name:"allocation",label:t.$t("allocation")}},[e("div",{staticClass:"mt-5",attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.allocation.open(s)}}},[t._v(" "+t._s(t._f("uppercase")(r.allocation_name||t.$t("select")))+" ")])])])],1),e("td")])]:t._e()]}))],2),e("div",{staticClass:"row mt-50"},[e("div",{staticClass:"col-sm-6"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"5",placeholder:"Notes"},domProps:{value:t.form.notes},on:{input:function(e){e.target.composing||t.$set(t.form,"notes",e.target.value)}}}),t._v(" "),e("div",{staticClass:"d-sm-block d-md-none mt-10"})]),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("requested by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" "+t._s(t._f("dateFormat")(t.form.date,"DD MMMM YYYY"))+" ")]),t._v(" "+t._s(t._f("uppercase")(t.requestedBy))+" "),e("div",{staticClass:"d-sm-block d-md-none mt-10"})]),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("approved by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" _______________ ")]),e("m-user",{attrs:{id:"user",label:t.form.approver_name,errors:t.form.errors.get("request_approval_to")},on:{errors:function(e){return t.form.errors.set("request_approval_to",null)},choosen:t.chooseApprover},model:{value:t.form.request_approval_to,callback:function(e){t.$set(t.form,"request_approval_to",e)},expression:"form.request_approval_to"}}),t._v(" "+t._s(t._f("uppercase")(t.form.approver_name))+" "),t.form.approver_email?e("br"):t._e(),t._v(" "),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(t._f("uppercase")(t.form.approver_email)))])],1),e("div",{staticClass:"col-sm-12"},[e("hr"),t.isLoading?t._e():e("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"submit",disabled:t.isSaving}},[e("i",{directives:[{name:"show",rawName:"v-show",value:t.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),t._v(" "+t._s(t._f("uppercase")(t.$t("save")))+" ")])])])],1)],1)],1)]),e("m-item",{ref:"item",on:{choosen:function(e){return t.chooseItem(e)}}}),e("m-user",{ref:"approver",on:{choosen:function(e){return t.chooseApprover(e)}}}),e("m-allocation",{ref:"allocation",on:{choosen:function(e){return t.chooseAllocation(e)}}})],1)},a=[],o=r("5530"),i=(r("7db0"),r("d3b7"),r("ac1f"),r("5319"),r("159b"),r("14d9"),r("b0c0"),r("4de4"),r("e9c4"),r("5ae6")),n=r("861c"),c=r("b7ae"),l=r("055b"),u=r("feee"),m=r("2f62"),p={components:{Breadcrumb:i["a"],BreadcrumbPurchase:n["a"],PointTable:u["a"],PurchaseMenu:l["a"]},data:function(){return{id:this.$route.params.id,isLoading:!0,isSaving:!1,totalPrice:0,requestedBy:null,form:new c["a"]({id:this.$route.params.id,date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),required_date:null,request_approval_to:null,approver_name:null,approver_email:null,notes:null,items:[]})}},computed:Object(o["a"])(Object(o["a"])({},Object(m["c"])("auth",["authUser"])),Object(m["c"])("purchaseRequest",["purchaseRequest"])),created:function(){var t=this;this.isLoading=!0,this.find({id:this.id,params:{join:"form,items,item",fields:"purchase_request.*",includes:"items.item.units;items.allocation;form.branch;form.createdBy;form.requestApprovalTo"}}).then((function(e){t.$formRules.allowedToUpdate(e.data.form)||t.$router.replace("/purchase/request/"+e.data.id),t.isLoading=!1,t.requestedBy=e.data.form.created_by.full_name,t.form.edited_form_number=e.data.form.edited_form_number,t.form.required_date=e.data.required_date,t.form.notes=e.data.form.notes,t.form.request_approval_to=e.data.form.request_approval_to.id,t.form.approver_name=e.data.form.request_approval_to.full_name,t.form.approver_email=e.data.form.request_approval_to.email,t.form.branch=e.data.form.branch,e.data.items.forEach((function(e,r){t.form.items.push({item_id:e.item_id,item_name:e.item.label,quantity:e.quantity,price:e.price,unit:e.unit,converter:e.converter,units:e.item.units,allocation_id:e.allocation_id,allocation_name:e.allocation?e.allocation.name:null,notes:e.notes,more:!1})})),t.addItemRow()})).catch((function(e){t.isLoading=!1,t.$notification.error(e.message)}))},methods:Object(o["a"])(Object(o["a"])({},Object(m["b"])("purchaseRequest",["find","update"])),{},{addItemRow:function(){this.form.items.push({item_id:null,item_name:null,unit:null,converter:null,quantity:null,allocation_id:null,allocation_name:null,notes:null,more:!1,units:[{label:"",name:"",converter:null}]})},chooseAllocation:function(t){var e=this.form.items[t.index];e.allocation_id=t.id,e.allocation_name=t.name},chooseApprover:function(t){this.form.approver_name=t.label,this.form.approver_email=t.email},chooseItem:function(t){var e=this.form.items[t.index];if(null==t.id)this.clearItem(e);else{e.item_id=t.id,e.item_name=t.label,e.units=t.units,e.units.forEach((function(r,s){r.id==t.unit_default_purchase&&(e.unit=r.label,e.converter=r.converter)}));var r=!0;this.form.items.forEach((function(t){null==t.item_id&&(r=!1)})),r&&this.addItemRow()}},chooseUnit:function(t,e){e.unit=t.label,e.converter=t.converter},toggleMore:function(){var t=this.form.items.some((function(t,e){return!1===t.more}));this.form.items.forEach((function(e){e.more=t}))},onSubmit:function(){var t=this;if(this.isSaving=!0,null==this.form.request_approval_to)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({request_approval_to:["Approver should not empty"]});this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.items.length>1&&(this.form.items=this.form.items.filter((function(t){return null!==t.item_id}))),this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.items.length>1&&(this.form.items=this.form.items.filter((function(t){return null!==t.item_id}))),this.update(this.form).then((function(e){t.isSaving=!1,t.form.reset(),t.$notification.success("Update success"),t.$router.push("/purchase/request/"+e.data.id)})).catch((function(e){t.isSaving=!1,t.form.errors.record(e.errors);var r="";e.errors&&(r='<pre class="text-left">'+JSON.stringify(e.errors,null,2)+"</pre>"),t.$alert.error("Error Message",e.message+r)}))}})},d=p,f=r("2877"),_=Object(f["a"])(d,s,a,!1,null,null,null);e["default"]=_.exports},"861c":function(t,e,r){"use strict";var s=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/purchase"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("purchase")))+" ")])},a=[],o=r("2877"),i={},n=Object(o["a"])(i,s,a,!1,null,null,null);e["a"]=n.exports}}]);
//# sourceMappingURL=chunk-38372159.224a9962.js.map
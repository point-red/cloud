(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12cd4213"],{"208e":function(e,t,s){"use strict";var r=function(){var e=this,t=e._self._c;return t("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("sales")))+" ")])},a=[],n=s("2877"),o={},i=Object(n["a"])(o,r,a,!1,null,null,null);t["a"]=i.exports},"2ca0":function(e,t,s){"use strict";var r=s("23e7"),a=s("4625"),n=s("06cf").f,o=s("50c4"),i=s("577e"),c=s("5a34"),l=s("1d80"),u=s("ab13"),d=s("c430"),m=a("".startsWith),f=a("".slice),p=Math.min,v=u("startsWith"),h=!d&&!v&&!!function(){var e=n(String.prototype,"startsWith");return e&&!e.writable}();r({target:"String",proto:!0,forced:!h&&!v},{startsWith:function(e){var t=i(l(this));c(e);var s=o(p(arguments.length>1?arguments[1]:void 0,t.length)),r=i(e);return m?m(t,r,s):f(t,s,s+r.length)===r}})},7134:function(e,t,s){"use strict";s("b5a1")},"7b79":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("breadcrumb",[t("breadcrumb-sales"),t("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales/invoice"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("sales invoice")))+" ")]),t("span",{staticClass:"breadcrumb-item active"},[e._v(e._s(e._f("uppercase")(e.$t("create"))))])],1),t("sales-menu"),t("form",{on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("div",{staticClass:"row"},[t("p-block",[t("p-block-inner",{attrs:{"is-loading":e.isLoading}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"},[t("h4",[e._v(e._s(e._f("uppercase")(e.$t("sales invoice"))))]),t("table",{staticClass:"table table-sm table-bordered"},[t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("date")))+" ")]),t("td",[t("p-date-picker",{attrs:{id:"date",name:"date",label:e.$t("date"),errors:e.form.errors.get("date")},on:{errors:function(t){return e.form.errors.set("date",null)}},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("reference")))+" ")]),t("td",[t("span",{staticClass:"select-link",on:{click:function(t){return e.$refs.selectReference.open()}}},[e.reference&&null!=e.referenceForm.number?[e._v(" "+e._s(e.referenceForm.number)+" ")]:[e._v(" "+e._s(e._f("uppercase")(e.$t("select")))+" ")]],2)])])])]),t("div",{staticClass:"col-sm-6 text-right"},[t("div",{staticClass:"mb-30"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.authUser.tenant_name))+" ")]),e.authUser.branch?[e._v(" "+e._s(e._f("uppercase")(e.authUser.branch.address))+" "),e.authUser.branch.address?t("br"):e._e(),e._v(" "+e._s(e._f("uppercase")(e.authUser.branch.phone))+" "),e.authUser.branch.phone?t("br"):e._e()]:e._e()],2),t("div",[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("to")))+": "),t("span",[e._v(e._s(e._f("uppercase")(e.form.customerName)))])]),e._v(" "+e._s(e._f("uppercase")(e.form.customerAddress))+" "),e.form.customerAddress?t("br"):e._e(),e._v(" "+e._s(e.form.customerPhone)+" "),e.form.customerPhone?t("br"):e._e()])])]),t("hr"),e.form.referenceId?t("point-table",[t("tr",{attrs:{slot:"p-head"},slot:"p-head"},[t("th",[e._v("#")]),t("th",{staticStyle:{"min-width":"120px"}},[e._v(" Item ")]),t("th",[e._v("Quantity")]),t("th",[e._v("Price")]),t("th",[e._v("Discount")]),t("th",[e._v("Total")]),t("th",[e._v("Allocation")])]),e._l(e.form.items,(function(s,r){return[t("tr",{key:r,attrs:{slot:"p-body"},slot:"p-body"},[t("th",[e._v(e._s(r+1))]),t("td",[e._v(" "+e._s(e._f("uppercase")(s.itemLabel||e.$t("select")))+" ")]),t("td",[t("p-quantity-custom",{attrs:{id:"quantity"+r,name:"quantity"+r,"item-id":s.itemId,units:s.units,unit:{name:s.unit,label:s.unit,converter:s.converter},disabled:"",readonly:""},model:{value:s.quantity,callback:function(t){e.$set(s,"quantity",t)},expression:"row.quantity"}})],1),t("td",[t("p-form-number",{attrs:{id:"price"+r,name:"price"+r,readonly:!1},model:{value:s.price,callback:function(t){e.$set(s,"price",e._n(t))},expression:"row.price"}})],1),t("td",[t("p-discount",{attrs:{id:"discount"+r,name:"discount"+r,readonly:null==s.itemId,"base-value":s.price,"discount-percent":s.discountPercent,"discount-value":s.discountValue},on:{"update:discountPercent":function(t){return e.$set(s,"discountPercent",t)},"update:discount-percent":function(t){return e.$set(s,"discountPercent",t)},"update:discountValue":function(t){return e.$set(s,"discountValue",t)},"update:discount-value":function(t){return e.$set(s,"discountValue",t)}}})],1),t("td",[t("p-form-number",{attrs:{id:"total-"+r,name:"total-"+r,readonly:!0,value:s.quantity*(s.price-s.discountValue)}})],1),t("td",[t("span",{class:{"select-link":"salesDeliveryNote"!==e.referenceType},on:{click:function(t){"salesDeliveryNote"!==e.referenceType&&e.$refs.allocation.open(r)}}},[e._v(e._s(s.allocationName||("salesDeliveryNote"===e.referenceType?"":"SELECT")))]),t("br")])])]}))],2):e._e(),e.form.referenceId?t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"14",placeholder:"Notes"},domProps:{value:e.form.notes},on:{input:function(t){t.target.composing||e.$set(e.form,"notes",t.target.value)}}})]),t("div",{staticClass:"col-sm-6"},[t("p-form-row",{attrs:{id:"discount",name:"discount",label:e.$t("discount")}},[t("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[t("p-discount",{attrs:{id:"discount",name:"discount","base-value":e.subtotal,"discount-percent":e.form.discountPercent,"discount-value":e.form.discountValue},on:{"update:discountPercent":function(t){return e.$set(e.form,"discountPercent",t)},"update:discount-percent":function(t){return e.$set(e.form,"discountPercent",t)},"update:discountValue":function(t){return e.$set(e.form,"discountValue",t)},"update:discount-value":function(t){return e.$set(e.form,"discountValue",t)}},model:{value:e.form.discountPercent,callback:function(t){e.$set(e.form,"discountPercent",t)},expression:"form.discountPercent"}})],1)]),t("p-form-row",{attrs:{id:"tax_base",name:"tax_base",label:e.$t("tax base")}},[t("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[t("p-form-number",{attrs:{id:"tax_base",name:"tax_base",readonly:!0,value:e.tax_base}})],1)]),t("p-form-row",{attrs:{name:"tax",label:e.$t("tax")}},[t("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[t("p-form-check-box",{staticClass:"mb-0",staticStyle:{float:"left"},attrs:{name:"tax",checked:"include"==e.form.typeOfTax,description:e.$t("include tax")},nativeOn:{click:function(t){return e.chooseTax("include")}}}),t("p-form-check-box",{attrs:{name:"tax",checked:"exclude"==e.form.typeOfTax,description:e.$t("exclude tax")},nativeOn:{click:function(t){return e.chooseTax("exclude")}}}),t("p-form-number",{attrs:{id:"total",name:"total",readonly:!0,value:e.tax}})],1)]),t("p-form-row",{attrs:{id:"total",name:"total",label:e.$t("total")}},[t("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[t("p-form-number",{attrs:{id:"total",name:"total",readonly:!0,value:e.total}})],1)])],1)]):e._e(),e.form.referenceId?t("hr"):e._e(),e.form.referenceId?t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"}),t("div",{staticClass:"col-sm-3 text-center"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("requested by")))+" ")]),t("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[e._v(" "+e._s(e._f("dateFormat")(Date.now(),"DD MMMM YYYY"))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.requestedBy))+" "),t("div",{staticClass:"d-sm-block d-md-none mt-10"})]),t("div",{staticClass:"col-sm-3 text-center"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("approved by")))+" ")]),t("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[e._v(" _______________ ")]),t("span",{staticClass:"select-link",on:{click:function(t){return e.$refs.approver.open()}}},[e._v(e._s(e._f("uppercase")(e.form.approverName||e.$t("select"))))]),t("br"),t("span",{staticStyle:{"font-size":"9px"}},[e._v(e._s(e._f("uppercase")(e.form.approverEmail)))])]),t("div",{staticClass:"col-sm-12"},[t("hr"),t("button",{staticClass:"btn btn-block btn-sm btn-primary",attrs:{type:"submit",disabled:e.isSaving}},[t("i",{directives:[{name:"show",rawName:"v-show",value:e.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),e._v(" "+e._s(e._f("uppercase")(e.$t("save")))+" ")])])]):e._e()],1)],1)],1)]),t("m-user",{ref:"approver",attrs:{permission:"approve sales invoice"},on:{choosen:e.chooseApprover}}),t("m-allocation",{ref:"allocation",on:{choosen:function(t){return e.chooseAllocation(t)}}}),t("select-reference",{ref:"selectReference",on:{choosen:e.chooseReference}})],1)},a=[],n=s("5530"),o=(s("13d5"),s("d3b7"),s("2ca0"),s("b0c0"),s("d81d"),s("14d9"),s("bea4")),i=s("5ae6"),c=s("208e"),l=s("b7ae"),u=s("feee"),d=function(){var e=this,t=e._self._c;return t("sweet-modal",{ref:"modal",attrs:{title:e._f("uppercase")("Select Reference"),"overlay-theme":"dark"},on:{close:function(t){return e.onClose()}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search..."},domProps:{value:e.searchText},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()},input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),t("hr"),e.isLoading?t("div",[t("h3",{staticClass:"text-center"},[e._v(" Loading ... ")])]):t("div",{staticClass:"list-group push table-responsive"},[t("table",{staticClass:"table table-sm"},[t("tr",[t("th",[e._v("Date Sales Order")]),t("th",[e._v("Sales Order")]),t("th",[e._v("Date Reference")]),t("th",[e._v("Form Reference")]),t("th",[e._v("Customer")]),t("th",[e._v("Item")]),t("th",[e._v("Quantity")])]),e._l(e.options,(function(s,r){return[t("tbody",{key:"request-"+r,staticClass:"cursor-pointer hover-active",attrs:{slot:"p-body"},on:{click:function(t){return e.choose(s)}},slot:"p-body"},[s.number.startsWith("SV")?[0===s.salesVisitation.items.length?[t("tr",[t("td",[e._v(e._s(null))]),t("td",[e._v(e._s(null))]),t("td",[e._v(e._s("".concat(e.$options.filters.dateFormat(s.date,"DD MMMM YYYY"))))]),t("td",[e._v(e._s(s.number))]),t("td",[e._v(e._s(s.salesVisitation.customer.name))]),t("td",[e._v(e._s(null))]),t("td",[e._v(e._s(null))])])]:e._e(),e._l(s.salesVisitation.items,(function(a,n){return[t("tr",{key:"request-"+r+"-"+n},[t("td",[e._v(e._s(null))]),t("td",[e._v(e._s(null))]),t("td",[e._v(e._s(0===n?"".concat(e.$options.filters.dateFormat(s.date,"DD MMMM YYYY")):null))]),t("td",[e._v(e._s(0===n?s.number:null))]),t("td",[e._v(e._s(0===n?s.salesVisitation.customer.name:null))]),t("td",[e._v(e._s(a.item.name))]),t("td",[e._v(e._s(a.quantity))])])]}))]:e._e(),s.number.startsWith("DN")?[e._l(s.salesDeliveryNote.items,(function(a,n){return[t("tr",{key:"request-"+r+"-"+n},[t("td",[e._v(e._s(0===n?"".concat(e.$options.filters.dateFormat(s.salesDeliveryNote.deliveryOrder.salesOrder.form.createdAt,"DD MMMM YYYY")):null))]),t("td",[e._v(e._s(0===n?s.salesDeliveryNote.deliveryOrder.salesOrder.form.number:null))]),t("td",[e._v(e._s(0===n?"".concat(e.$options.filters.dateFormat(s.date,"DD MMMM YYYY")):null))]),t("td",[e._v(e._s(0===n?s.number:null))]),t("td",[e._v(e._s(0===n?s.salesDeliveryNote.customerName:null))]),t("td",[e._v(e._s(a.itemName))]),t("td",[e._v(e._s(a.quantity))])])]}))]:e._e()],2)]}))],2),t("p-pagination",{attrs:{"current-page":e.currentPage,"last-page":e.lastPage},on:{updatePage:e.updatePage}})],1),e.searchText&&0==e.options.length&&!e.isLoading?t("div",{staticClass:"alert alert-info text-center"},[e._v(" "+e._s(e._f("capitalize")(e.$t("searching not found",[e.searchText])))+" ")]):e._e(),t("div",{staticClass:"pull-right"},[t("button",{staticClass:"btn btn-sm btn-outline-danger",attrs:{type:"button"},on:{click:function(t){return e.clear()}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("clear")))+" ")])])])},m=[],f=(s("a9e3"),s("ac1f"),s("841c"),s("b047")),p=s.n(f),v=s("2f62"),h={props:{id:{type:String,default:""},value:{type:[String,Number],default:""}},data:function(){return{index:null,searchText:"",currentPage:1,lastPage:1,options:[],selected:{},isLoading:!1}},watch:{searchText:p()((function(){this.currentPage=1,this.search()}),300)},methods:Object(n["a"])(Object(n["a"])({},Object(v["b"])("salesReference",["get"])),{},{search:function(){var e=this;this.isLoading=!0,this.get({params:{filter_like:{number:this.searchText,created_at:this.searchText,"salesDeliveryNote.customer.name":this.searchText,"salesDeliveryNote.deliveryOrder.salesOrder.created_at":this.searchText,"salesDeliveryNote.deliveryOrder.salesOrder.form.number":this.searchText,"salesVisitation.customer.name":this.searchText,"salesVisitation.created_at":this.searchText},limit:10,page:this.currentPage}}).then((function(t){e.options=t.data,e.lastPage=t.meta.last_page})).finally((function(){e.isLoading=!1}))},clear:function(e){this.$emit("choosen",{id:null,form:{number:null}}),this.close()},choose:function(e){this.$emit("choosen",e),this.close()},open:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.index=e,this.search(),this.$refs.modal.open()},close:function(){this.$refs.modal.close()},onClose:function(){this.searchText="",this.$emit("close",!0)},getOptionItems:function(e){return e.deliveryNote.items?e.deliveryNote.items:e.salesVisitation.items?e.salesVisitation.items:[]},updatePage:function(e){this.currentPage=e,this.search()}})},_=h,b=(s("7134"),s("2877")),y=Object(b["a"])(_,d,m,!1,null,"2c89180f",null),x=y.exports,g={components:{SalesMenu:o["a"],Breadcrumb:i["a"],BreadcrumbSales:c["a"],PointTable:u["a"],SelectReference:x},data:function(){return{isSaving:!1,isLoading:!1,requestedBy:localStorage.getItem("fullName"),referenceForm:null,reference:null,referenceType:null,form:new l["a"]({date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),customerId:null,customerName:null,customerLabel:null,customerAddress:null,customerPhone:null,customerEmail:null,notes:null,discountPercent:0,discountValue:0,tax_base:0,tax:0,typeOfTax:"exclude",items:[],requestApprovalTo:null,approverName:null,approverEmail:null,referenceId:null})}},computed:Object(n["a"])(Object(n["a"])({},Object(v["c"])("auth",["authUser"])),{},{subtotal:function(){return this.form.items.reduce((function(e,t){return e+t.quantity*(t.price-t.discountValue)}),0)},tax_base:function(){return this.subtotal-this.form.discountValue},tax:function(){var e=0;return"include"==this.form.typeOfTax?e=this.tax_base-10*this.tax_base/11:"exclude"==this.form.typeOfTax&&(e=this.tax_base/10),e},total:function(){return"include"==this.form.typeOfTax?this.subtotal-this.form.discountValue:this.subtotal-this.form.discountValue+this.tax}}),methods:Object(n["a"])(Object(n["a"])({},Object(v["b"])("salesInvoice",["create"])),{},{chooseApprover:function(e){this.form.requestApprovalTo=e.id,this.form.approverName=e.fullName,this.form.approverEmail=e.email},chooseTax:function(e){e==this.form.typeOfTax?this.form.typeOfTax=null:this.form.typeOfTax=e},chooseReference:function(e){e.number.startsWith("DN")&&(this.referenceType="salesDeliveryNote"),e.number.startsWith("SV")&&(this.referenceType="salesVisitation");var t=e[this.referenceType];"salesDeliveryNote"===this.referenceType&&(this.form.typeOfTax=t.deliveryOrder.salesOrder.typeOfTax),this.referenceForm=e,this.reference=t,this.form.referenceId=t.id,this.form.customerId=t.customer.id,this.form.customerName=t.customer.name,this.form.customerLabel=t.customer.label,this.form.discountPercent=t.deliveryOrder.salesOrder.discountPercent,this.form.discountValue=t.deliveryOrder.salesOrder.discountValue,this.form.items=t.items.map((function(e){return{referenceItemId:e.id,itemId:e.itemId,itemName:e.item.name,itemLabel:e.item.name,more:!1,unit:e.unit,converter:e.converter,quantity:e.quantity,price:e.price,discountPercent:e.deliveryOrderItem.salesOrderItem.discountPercent,discountValue:e.deliveryOrderItem.salesOrderItem.discountValue,total:e.quantity*(e.price-e.deliveryOrderItem.salesOrderItem.discountValue),notes:e.notes,allocationId:e.allocation&&e.allocation.id,allocationName:e.allocation&&e.allocation.name,expiryDate:e.expiryDate,productionNumber:e.productionNumber}}))},chooseAllocation:function(e){var t=this.form.items[e.index];t.allocationId=e.id,t.allocationName=e.name},onSubmit:function(){var e=this;if(this.isSaving=!0,null==this.form.requestApprovalTo)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({requestApprovalTo:["Approver should not empty"]});var t=this.form.items.map((function(e){return{itemId:e.itemId,referenceItemId:e.referenceItemId,quantity:e.quantity,itemUnit:e.unit,converter:e.converter,allocationId:e.allocationId,price:e.price,discountPercent:e.discountPercent,discountValue:e.discountValue,expiryDate:e.expiryDate,productionNumber:e.productionNumber}})),s={formId:this.referenceForm.id,items:t,requestApprovalTo:this.form.requestApprovalTo,dueDate:this.form.date,discountPercent:this.form.discountPercent,discountValue:this.form.discountValue,customerId:this.form.customerId,typeOfTax:this.form.typeOfTax||"non",notes:this.form.notes};this.create(s).then((function(t){e.isSaving=!1,e.$notification.success("create success"),Object.assign(e.$data,e.$options.data.call(e)),e.$router.push("/sales/invoice/"+t.data.salesInvoice.id)})).catch((function(t){e.isSaving=!1,e.$notification.error(t.message),e.form.errors.record(t.errors)}))}})},$=g,O=Object(b["a"])($,r,a,!1,null,null,null);t["default"]=O.exports},b5a1:function(e,t,s){}}]);
//# sourceMappingURL=chunk-12cd4213.0f772e61.js.map
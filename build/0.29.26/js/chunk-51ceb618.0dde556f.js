(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51ceb618"],{"208e":function(t,e,a){"use strict";var s=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales")))+" ")])},r=[],o=a("2877"),n={},i=Object(o["a"])(n,s,r,!1,null,null,null);e["a"]=i.exports},dc61:function(t,e,a){"use strict";a.r(e);a("b0c0");var s=function(){var t=this,e=t._self._c;return e("div",[e("breadcrumb",[e("breadcrumb-sales"),e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales/invoice"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales invoice")))+" ")]),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")(t.$t("create"))))])],1),e("sales-menu"),e("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("div",{staticClass:"row"},[e("p-block",[e("p-block-inner",{attrs:{"is-loading":t.isLoading}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("h4",[t._v(t._s(t._f("uppercase")(t.$t("sales invoice"))))]),e("table",{staticClass:"table table-sm table-bordered"},[e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("date")))+" ")]),e("td",[e("p-date-picker",{attrs:{id:"date",name:"date",label:t.$t("date"),errors:t.form.errors.get("date")},on:{errors:function(e){return t.form.errors.set("date",null)}},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)]),e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("Form number")))+" ")]),e("td",[e("span",[t._v(" "+t._s(t._f("uppercase")(t.form.number))+" ")])])]),e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("reference")))+" ")]),e("td",[e("span",[t.reference&&null!=t.reference.form.number?[t._v(" "+t._s(t._f("uppercase")(t.reference.form.number))+" ")]:[t._v(" "+t._s(t._f("uppercase")(t.$t("select")))+" ")]],2)])])])]),e("div",{staticClass:"col-sm-6 text-right"},[e("div",{staticClass:"mb-30"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.authUser.tenant_name))+" ")]),t.authUser.branch?[t._v(" "+t._s(t._f("uppercase")(t.authUser.branch.address))+" "),t.authUser.branch.address?e("br"):t._e(),t._v(" "+t._s(t._f("uppercase")(t.authUser.branch.phone))+" "),t.authUser.branch.phone?e("br"):t._e()]:t._e()],2),e("div",[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("to")))+": "),e("span",[t._v(t._s(t._f("uppercase")(t.form.customerName)))])]),t._v(" "+t._s(t._f("uppercase")(t.form.customerAddress))+" "),t.form.customerAddress?e("br"):t._e(),t._v(" "+t._s(t.form.customerPhone)+" "),t.form.customerPhone?e("br"):t._e()])])]),e("hr"),t.form.referenceId?e("point-table",[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",[t._v("#")]),e("th",{staticStyle:{"min-width":"120px"}},[t._v(" Item ")]),e("th",[t._v("Quantity")]),e("th",[t._v("Price")]),e("th",[t._v("Discount")]),e("th",[t._v("Total")]),e("th",[t._v("Allocation")])]),t._l(t.form.items,(function(a,s){return[e("tr",{key:s,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[t._v(t._s(s+1))]),e("td",[t._v(" "+t._s(t._f("uppercase")(a.itemName||t.$t("select")))+" ")]),e("td",[e("p-quantity-custom",{attrs:{id:"quantity"+s,name:"quantity"+s,"item-id":a.itemId,units:a.units,unit:{name:a.unit,label:a.unit,converter:a.converter},disabled:"",readonly:""},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"row.quantity"}})],1),e("td",[e("p-form-number",{attrs:{id:"price"+s,name:"price"+s,readonly:!1},model:{value:a.price,callback:function(e){t.$set(a,"price",t._n(e))},expression:"row.price"}})],1),e("td",[e("p-discount",{attrs:{id:"discount"+s,name:"discount"+s,readonly:null==a.itemId,"base-value":a.price,"discount-percent":a.discountPercent,"discount-value":a.discountValue},on:{"update:discountPercent":function(e){return t.$set(a,"discountPercent",e)},"update:discount-percent":function(e){return t.$set(a,"discountPercent",e)},"update:discountValue":function(e){return t.$set(a,"discountValue",e)},"update:discount-value":function(e){return t.$set(a,"discountValue",e)}}})],1),e("td",[e("p-form-number",{attrs:{id:"total-"+s,name:"total-"+s,readonly:!0,value:a.quantity*(a.price-a.discountValue)}})],1),e("td",["salesVisitation"===t.referenceType?e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.allocation.open(s)}}},[t._v(t._s(t._f("uppercase")(a.allocation&&a.allocation.name||t.$t("select"))))]):e("span",[t._v(t._s(a.allocation&&a.allocation.name||""))]),e("br")])])]}))],2):t._e(),t.form.referenceId?e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"14",placeholder:"Notes"},domProps:{value:t.form.notes},on:{input:function(e){e.target.composing||t.$set(t.form,"notes",e.target.value)}}})]),e("div",{staticClass:"col-sm-6"},[e("p-form-row",{attrs:{id:"discount",name:"discount",label:t.$t("discount")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-discount",{attrs:{id:"discount",name:"discount","base-value":t.subtotal,"discount-percent":t.form.discountPercent,"discount-value":t.form.discountValue},on:{"update:discountPercent":function(e){return t.$set(t.form,"discountPercent",e)},"update:discount-percent":function(e){return t.$set(t.form,"discountPercent",e)},"update:discountValue":function(e){return t.$set(t.form,"discountValue",e)},"update:discount-value":function(e){return t.$set(t.form,"discountValue",e)}},model:{value:t.form.discountPercent,callback:function(e){t.$set(t.form,"discountPercent",e)},expression:"form.discountPercent"}})],1)]),e("p-form-row",{attrs:{id:"taxBase",name:"taxBase",label:t.$t("tax base")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"taxBase",name:"taxBase",readonly:!0,value:t.taxBase}})],1)]),e("p-form-row",{attrs:{name:"tax",label:t.$t("tax")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("p-form-check-box",{staticClass:"mb-0",staticStyle:{float:"left"},attrs:{name:"tax",checked:"include"==t.form.typeOfTax,description:t.$t("include tax")},nativeOn:{click:function(e){return t.chooseTax("include")}}}),e("p-form-check-box",{attrs:{name:"tax",checked:"exclude"==t.form.typeOfTax,description:t.$t("exclude tax")},nativeOn:{click:function(e){return t.chooseTax("exclude")}}}),e("p-form-number",{attrs:{id:"total",name:"total",readonly:!0,value:t.tax}})],1)]),e("p-form-row",{attrs:{id:"total",name:"total",label:t.$t("total")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"total",name:"total",readonly:!0,value:t.total}})],1)])],1)]):t._e(),t.form.referenceId?e("hr"):t._e(),t.form.referenceId?e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"}),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("requested by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" "+t._s(t._f("dateFormat")(Date.now(),"DD MMMM YYYY"))+" ")]),t._v(" "+t._s(t._f("uppercase")(t.requestedBy))+" "),e("div",{staticClass:"d-sm-block d-md-none mt-10"})]),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("approved by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" _______________ ")]),e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.approver.open()}}},[t._v(t._s(t._f("uppercase")(t.form.approverName||t.$t("select"))))]),e("br"),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(t._f("uppercase")(t.form.approverEmail)))])]),e("div",{staticClass:"col-sm-12"},[e("hr"),e("button",{staticClass:"btn btn-block btn-sm btn-primary",attrs:{type:"submit",disabled:t.isSaving}},[e("i",{directives:[{name:"show",rawName:"v-show",value:t.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),t._v(" "+t._s(t._f("uppercase")(t.$t("save")))+" ")])])]):t._e()],1)],1)],1)]),e("m-user",{ref:"approver",attrs:{permission:"approve sales invoice"},on:{choosen:t.chooseApprover}}),e("m-allocation",{ref:"allocation",on:{choosen:function(e){return t.chooseAllocation(e)}}})],1)},r=[],o=a("5530"),n=(a("13d5"),a("d3b7"),a("7db0"),a("159b"),a("4de4"),a("d81d"),a("14d9"),a("bea4")),i=a("5ae6"),c=a("208e"),l=a("b7ae"),u=a("feee"),d=a("2f62"),m={components:{SalesMenu:n["a"],Breadcrumb:i["a"],BreadcrumbSales:c["a"],PointTable:u["a"]},data:function(){return{isSaving:!1,isLoading:!1,requestedBy:localStorage.getItem("fullName"),reference:null,referenceType:null,referenceTypes:{SalesDeliveryNote:"salesDeliveryNote",SalesVisitation:"salesVisitation"},form:new l["a"]({increment_group:this.$moment().format("YYYYMM"),date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),customerId:null,customerName:null,customerLabel:null,customerAddress:null,customerPhone:null,customerEmail:null,pricingGroupId:1,need_down_payment:0,cash_only:!1,notes:null,discountPercent:0,discountValue:0,taxBase:0,tax:0,typeOfTax:"exclude",items:[],requestApprovalTo:null,approverName:null,approverEmail:null,referenceId:null})}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(d["c"])("salesInvoice",["invoice"])),Object(d["c"])("auth",["authUser"])),{},{subtotal:function(){return this.form.items.reduce((function(t,e){return t+e.quantity*(e.price-e.discountValue)}),0)},taxBase:function(){return this.subtotal-this.form.discountValue},tax:function(){var t=0;return"include"==this.form.typeOfTax?t=this.taxBase-10*this.taxBase/11:"exclude"==this.form.typeOfTax&&(t=this.taxBase/10),t},total:function(){return"include"==this.form.typeOfTax?this.subtotal-this.form.discountValue:this.subtotal-this.form.discountValue+this.tax}}),created:function(){var t=this;this.$route.params.id&&(this.isLoading=!0,this.find({id:this.$route.params.id}).then((function(e){t.isLoading=!1,t.referenceType=t.referenceTypes[e.data.referenceableType],t.form.referenceId=e.data.id,t.form.number=e.data.form.number,t.form.date=e.data.form.date,t.form.customerId=e.data.customerId,t.form.customerName=e.data.customerName,t.form.notes=e.data.form.notes,t.form.typeOfTax=e.data.typeOfTax,t.form.amount=e.data.amount,t.form.discountValue=e.data.discountValue,t.form.discountPercent=e.data.discountPercent,t.form.items=e.data.items,t.form.requestApprovalTo=e.data.form.requestApprovalToUser.id,t.form.approverName=e.data.form.requestApprovalToUser.fullName,t.form.approverEmail=e.data.form.requestApprovalToUser.email,t.form.items.forEach((function(t){t.referenceItemId=t.itemId})),t.reference=e.data.referenceable})).catch((function(e){t.isLoading=!1,t.$notification.error(e.message)})))},methods:Object(o["a"])(Object(o["a"])({},Object(d["b"])("salesInvoice",["find","update"])),{},{chooseApprover:function(t){this.form.requestApprovalTo=t.id,this.form.approverName=t.fullName,this.form.approverEmail=t.email},chooseTax:function(t){t==this.form.typeOfTax?this.form.typeOfTax=null:this.form.typeOfTax=t},chooseAllocation:function(t){var e=this.form.items[t.index];e.allocationId=t.id,e.allocation={id:t.id,name:t.name}},onSubmit:function(){var t=this;if(this.isSaving=!0,null==this.form.requestApprovalTo)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({requestApprovalTo:["Approver should not empty"]});this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.subtotal=this.subtotal,this.form.taxBase=this.taxBase,this.form.tax=this.tax,this.form.total=this.total,this.form.items=this.form.items.filter((function(t){return t.itemId}));var e=this.form.items.map((function(t){return{salesInvoiceItemId:t.id,allocationId:t.allocationId,discountPercent:t.discountPercent,discountValue:t.discountValue,price:t.price}})),a={id:this.invoice.id,items:e,requestApprovalTo:this.form.requestApprovalTo,dueDate:this.form.date,discountPercent:this.form.discountPercent,discountValue:this.form.discountValue,typeOfTax:this.form.typeOfTax||"non",notes:this.form.notes};this.update(a).then((function(e){t.isSaving=!1,t.$notification.success("update success"),Object.assign(t.$data,t.$options.data.call(t)),t.$router.push("/sales/invoice/"+e.data.id)})).catch((function(e){t.isSaving=!1,t.$notification.error(e.message),t.form.errors.record(e.errors)}))}})},f=m,p=a("2877"),v=Object(p["a"])(f,s,r,!1,null,null,null);e["default"]=v.exports}}]);
//# sourceMappingURL=chunk-51ceb618.0dde556f.js.map
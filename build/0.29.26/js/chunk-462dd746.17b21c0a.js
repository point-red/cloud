(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-462dd746"],{"208e":function(t,e,a){"use strict";var s=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales")))+" ")])},r=[],o=a("2877"),i={},n=Object(o["a"])(i,s,r,!1,null,null,null);e["a"]=n.exports},5224:function(t,e,a){"use strict";a("d41f")},b25f:function(t,e,a){"use strict";a.r(e);a("99af"),a("b0c0");var s=function(){var t=this,e=t._self._c;return e("div",[e("breadcrumb",[e("breadcrumb-sales"),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")(t.$t("sales invoice"))))])],1),e("sales-menu"),e("div",{staticClass:"row"},[e("p-block",[e("div",{staticClass:"input-group block"},[e("download-excel",{staticClass:"input-group-prepend",attrs:{name:"Sales Invoice_".concat(t.$options.filters.dateFormat(t.date.start,"DD MMM YYYY")," - ").concat(t.$options.filters.dateFormat(t.date.end,"DD MMM YYYY")),fetch:t.generateReport}},[e("span",{staticClass:"input-group-text"},[e("i",{staticClass:"fa fa-download"})])]),t.$permission.has("create sales invoice")?e("router-link",{staticClass:"input-group-prepend",attrs:{to:"/sales/invoice/create"}},[e("span",{staticClass:"input-group-text"},[e("i",{staticClass:"fa fa-plus"})])]):t._e(),e("p-form-input",{ref:"searchText",staticClass:"btn-block",attrs:{id:"search-text",name:"search-text",placeholder:"Search",value:t.searchText},on:{input:t.filterSearch}})],1),e("div",{staticClass:"text-center font-size-sm"},[e("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){t.isAdvanceFilter=!t.isAdvanceFilter}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("advance filter")))+" "),e("i",{staticClass:"fa fa-caret-down"})])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isAdvanceFilter,expression:"isAdvanceFilter"}],staticClass:"card m-5 pt-10",class:{fadeIn:t.isAdvanceFilter}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-3 text-center"},[e("p-form-row",{attrs:{id:"date-start",name:"date-start",label:t.$t("date start"),"is-horizontal":!1}},[e("div",{attrs:{slot:"body"},slot:"body"},[e("p-date-picker",{attrs:{id:"date",name:"date",label:"date"},model:{value:t.date.start,callback:function(e){t.$set(t.date,"start",e)},expression:"date.start"}})],1)])],1),e("div",{staticClass:"col-sm-3 text-center"},[e("p-form-row",{attrs:{id:"date-end",name:"date-end",label:t.$t("date end"),"is-horizontal":!1}},[e("div",{attrs:{slot:"body"},slot:"body"},[e("p-date-picker",{attrs:{id:"date",name:"date",label:"date"},model:{value:t.date.end,callback:function(e){t.$set(t.date,"end",e)},expression:"date.end"}})],1)])],1),e("div",{staticClass:"col-sm-3 text-center"},[e("p-form-row",{attrs:{id:"form-approval-status",name:"form-approval-status",label:t.$t("approval status"),"is-horizontal":!1}},[e("div",{attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.formApprovalStatus.open()}}},[t._v(" "+t._s(t._f("uppercase")(t.formApprovalStatus.label||t.$t("select")))+" ")])])])],1),e("div",{staticClass:"col-sm-3 text-center"},[e("p-form-row",{attrs:{id:"form-status",name:"form-status",label:t.$t("form status"),"is-horizontal":!1}},[e("div",{attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.formStatus.open()}}},[t._v(" "+t._s(t._f("uppercase")(t.formStatus.label||t.$t("select")))+" ")])])])],1)]),e("hr")]),e("hr"),e("p-block-inner",{attrs:{"is-loading":t.isLoading}},[e("point-table",[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",[t._v("Number")]),e("th",[t._v("Date")]),e("th",[t._v("Customer")]),e("th",[t._v("Notes")]),e("th",[t._v("Item")]),e("th",[t._v("Allocation")]),e("th",{staticClass:"text-right"},[t._v(" Quantity ")]),e("th",[t._v("Price")]),e("th",[t._v("Value")]),e("th",[t._v("Approval")]),e("th",{staticClass:"text-center"},[t._v(" Form Status ")]),e("th",{attrs:{width:"50px"}})]),t._l(t.invoices,(function(a,s){return t._l(a.items,(function(r,o){return e("tr",{key:"pr-"+s+"-i-"+o,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[e("router-link",{attrs:{to:{name:"sales.invoice.show",params:{id:a.id}}}},[t._v(" "+t._s(a.form.number)+" ")])],1),e("td",[t._v(t._s(t._f("dateFormat")(a.form.date,"DD MMMM YYYY")))]),e("td",[a.customer?[t._v(" "+t._s(a.customer.name)+" ")]:t._e()],2),e("td",{staticClass:"text-break"},[t._v(" "+t._s(a.form.notes)+" ")]),e("td",[t._v(t._s(r.itemName))]),e("td",[t._v(t._s(r.allocation&&r.allocation.name))]),e("td",{staticClass:"text-right"},[t._v(" "+t._s(t._f("numberFormat")(r.quantity))+" "+t._s(r.unit)+" ")]),e("td",[t._v(" "+t._s(t._f("numberFormat")(r.price))+" ")]),e("td",[t._v(" "+t._s(t._f("numberFormat")(r.quantity*r.price))+" ")]),e("td",{staticClass:"text-center"},[0==a.form.approvalStatus?e("div",{staticClass:"badge badge-primary"},[t._v(" "+t._s(t._f("uppercase")(t.$t("pending")))+" ")]):t._e(),-1==a.form.approvalStatus?e("div",{staticClass:"badge badge-danger"},[t._v(" "+t._s(t._f("uppercase")(t.$t("rejected")))+" ")]):t._e(),1==a.form.approvalStatus?e("div",{staticClass:"badge badge-success"},[t._v(" "+t._s(t._f("uppercase")(t.$t("approved")))+" ")]):t._e()]),e("td",{staticClass:"text-center"},[1==a.form.cancellationStatus?e("div",{staticClass:"badge badge-danger"},[t._v(" "+t._s(t._f("uppercase")(t.$t("canceled")))+" ")]):0==a.form.done?e("div",{staticClass:"badge badge-primary"},[t._v(" "+t._s(t._f("uppercase")(t.$t("pending")))+" ")]):1==a.form.done?e("div",{staticClass:"badge badge-success"},[t._v(" "+t._s(t._f("uppercase")(t.$t("done")))+" ")]):t._e()]),e("td")])}))}))],2)],1),e("p-pagination",{attrs:{"current-page":t.currentPage,"last-page":t.lastPage},on:{updatePage:t.updatePage}}),e("m-form-approval-status",{ref:"formApprovalStatus",on:{choosen:function(e){return t.chooseFormApprovalStatus(e)}}}),e("m-form-status",{ref:"formStatus",on:{choosen:function(e){return t.chooseFormStatus(e)}}})],1)],1)],1)},r=[],o=a("c7eb"),i=a("1da1"),n=a("5530"),c=(a("ac1f"),a("841c"),a("14d9"),a("d3b7"),a("d81d"),a("0481"),a("4069"),a("13d5"),a("f2d9")),l=a("bea4"),u=a("5ae6"),d=a("208e"),m=a("feee"),p=a("b047"),f=a.n(p),v=a("fa1a"),h=a("2f62"),_={components:{SalesMenu:l["a"],Breadcrumb:u["a"],BreadcrumbSales:d["a"],PointTable:m["a"],DownloadExcel:c["a"]},data:function(){return{isLoading:!0,searchText:this.$route.query.search,currentPage:1*this.$route.query.page||1,lastPage:1,limit:10,isAdvanceFilter:!1,checkedRow:[],formStatus:{id:null,label:null,value:"notArchived"},formApprovalStatus:{id:null,label:null,value:null},date:{start:this.$route.query.date_from?this.$moment(this.$route.query.date_from).format("YYYY-MM-DD 00:00:00"):this.$moment().format("YYYY-MM-01 00:00:00"),end:this.$route.query.date_to?this.$moment(this.$route.query.date_to).format("YYYY-MM-DD 23:59:59"):this.$moment().format("YYYY-MM-DD 23:59:59")},approvalStatusses:{0:"pending",1:"approved","-1":"reject"}}},computed:Object(n["a"])({},Object(h["c"])("salesInvoice",["invoices","pagination"])),watch:{date:{handler:function(){this.$router.push({query:Object(n["a"])(Object(n["a"])({},this.$route.query),{},{page:1,date_from:this.date.start,date_to:this.date.end})}),this.currentPage=1,this.getInvoices()},deep:!0}},created:function(){this.$router.push({query:Object(n["a"])(Object(n["a"])({},this.$route.query),{},{date_from:this.date.start,date_to:this.date.end})}),this.getInvoices()},updated:function(){this.lastPage=this.pagination.last_page},methods:Object(n["a"])(Object(n["a"])({},Object(h["b"])("salesInvoice",["get"])),{},{filterSearch:f()((function(t){this.$router.push({query:Object(n["a"])(Object(n["a"])({},this.$route.query),{},{search:t})}),this.searchText=t,this.currentPage=1,this.getInvoices()}),300),chooseFormStatus:f()((function(t){this.$router.push({query:Object(n["a"])(Object(n["a"])({},this.$route.query),{},{page:1})}),this.formStatus.label=t.label,this.formStatus.value=t.value,this.currentPage=1,this.getInvoices()})),chooseFormApprovalStatus:f()((function(t){this.$router.push({query:Object(n["a"])(Object(n["a"])({},this.$route.query),{},{page:1})}),this.formApprovalStatus.label=t.label,this.formApprovalStatus.value=t.value,this.currentPage=1,this.getInvoices()})),getInvoices:function(){var t=this;this.isLoading=!0;var e=this.formStatus.value&&this.formStatus.value.split(";")[1]||null,a=this.formApprovalStatus.value||null;this.get({params:{filter_form:e+";"+a,filter_like:{"form.number":this.searchText,"form.notes":this.searchText,"customer.name":this.searchText,"items.item_name":this.searchText,"items.allocation.name":this.searchText},filter_date_min:this.serverDateTime(this.date.start,"start"),filter_date_max:this.serverDateTime(this.date.end,"end"),limit:10,page:this.currentPage}}).catch((function(e){t.$notification.error(e.message)})).finally((function(){t.isLoading=!1}))},updatePage:function(t){this.currentPage=t,this.getInvoices()},generateReport:function(){var t=this;return Object(i["a"])(Object(o["a"])().mark((function e(){var a,s,r,i,n,c;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.prev=1,a=t.formStatus.value&&t.formStatus.value.split(";")[1]||null,s=t.formApprovalStatus.value||null,e.next=6,v["a"].get("/sales/invoices",{params:{filter_form:a+";"+s,filter_like:{"form.number":t.searchText,"form.notes":t.searchText,"customer.name":t.searchText,"items.item_name":t.searchText,"items.allocation.name":t.searchText},filter_date_min:t.serverDateTime(t.date.start,"start"),filter_date_max:t.serverDateTime(t.date.end,"end"),limit:1e4,page:1}});case 6:return r=e.sent,i=r.data.data,n=0,c=i.map((function(e){var a=t.getSubTotal(e.items),s="";return 1==e.form.cancellationStatus?s="cancelled":0==e.form.done?s="pending":1==e.form.done&&(s="done"),e.items.map((function(r){return n++,{No:n,"Form Number":e.form.number,"Invoice Date":t.$options.filters.dateFormat(e.form.date,"DD/MM/YYYY"),Customer:e.customer&&e.customer.name,Item:r.itemName,Allocation:r.allocation&&r.allocation.name,Quantity:r.quantity,Unit:r.unit,Price:r.price,"Discount Item":r.discountValue,"Sub Total":a,Discount:e.discountValue,"Tax Method":e.typeOfTax,Tax:e.tax,Total:e.amount,"Created at":t.$options.filters.dateFormat(e.form.createdAt,"DD/mm/YYYY HH:mm:ss"),"Created by":e.form.createdByUser&&e.form.createdByUser.name,"Approved by":e.form.approvalByUser&&e.form.approvalByUser.name,"Approval status":t.approvalStatusses[e.form.approvalStatus],"Form status":s}}))})),t.isLoading=!1,e.abrupt("return",c.flat());case 14:return e.prev=14,e.t0=e["catch"](1),console.log(e.t0),t.isLoading=!1,e.abrupt("return",t.$notification.error(e.t0.message));case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))()},getSubTotal:function(t){var e=this,a=t.reduce((function(t,a){return t+e.getItemsPrice(a)}),0);return a},getItemsPrice:function(t){var e=t.price;if(t.discountValue>0&&(e-=t.discountValue),t.discountPercent>0){var a=t.discountPercent/100;e-=e*a}var s=e*t.quantity;return s}})},b=_,g=(a("5224"),a("2877")),$=Object(g["a"])(b,s,r,!1,null,null,null);e["default"]=$.exports},d41f:function(t,e,a){}}]);
//# sourceMappingURL=chunk-462dd746.17b21c0a.js.map
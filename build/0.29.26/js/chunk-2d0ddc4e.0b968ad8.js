(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ddc4e"],{8396:function(t,e,r){"use strict";r.r(e);r("99af"),r("b0c0");var o=function(){var t=this,e=t._self._c;return e("div",[e("p-loading-block",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],attrs:{message:t.loadingMessage}}),e("breadcrumb",[e("breadcrumb-plugin"),e("breadcrumb-pin-point"),e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/plugin/pin-point/sales-visitation-form"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales visitation")))+" ")]),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")(t.$t("create"))))])],1),e("tab-menu"),e("form",{staticClass:"row",on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("p-block",{attrs:{"is-loading":t.isLoading,header:!1,title:t.$t("sales visitation"),column:"col-sm-12"}},[e("h5",[t._v(t._s(t._f("uppercase")(t.$t("sales visitation"))))]),e("hr"),e("p-form-row",{attrs:{label:t.$t("photo")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("p-camera",{attrs:{image:t.form.image},on:{onCaptured:function(e){return t.onCaptured(e)}}})],1)]),e("p-form-row",{attrs:{id:"customer",name:"customer",label:t.$t("customer"),disabled:t.isSaving,errors:t.form.errors.get("customer")},on:{errors:function(e){return t.form.errors.set("customer",null)}},model:{value:t.form.customer,callback:function(e){t.$set(t.form,"customer",e)},expression:"form.customer"}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.customer.open()}}},[t._v(t._s(t._f("uppercase")(t.form.customer_name||t.$t("select"))))])])]),e("p-form-row",{attrs:{label:"customer group"}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.group.open()}}},[t._v(t._s(t._f("uppercase")(t.form.group_name||t.$t("select"))))])])]),e("p-form-row",{attrs:{id:"gmap",name:"gmap",label:"Google Map - "+t.$t("address"),placeholder:""+t.$t("address")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("iframe",{staticStyle:{border:"none"},attrs:{width:"100%",height:"250",src:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/".concat(t.center.lng,",").concat(t.center.lat,",16,0,0/800x250?access_token=").concat(t.mapboxApiKey),title:"Streets"}})])]),e("p-form-row",{attrs:{id:"address",name:"address",label:t.$t("address"),placeholder:t.$t("address"),disabled:t.isSaving,errors:t.form.errors.get("address")},on:{errors:function(e){return t.form.errors.set("address",null)}},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}}),e("p-form-row",{attrs:{id:"district",name:"district",placeholder:t.$t("district"),disabled:t.isSaving,errors:t.form.errors.get("district")},on:{errors:function(e){return t.form.errors.set("district",null)}},model:{value:t.form.district,callback:function(e){t.$set(t.form,"district",e)},expression:"form.district"}}),e("p-form-row",{attrs:{id:"sub_district",name:"sub_district",placeholder:t.$t("sub district"),disabled:t.isSaving,errors:t.form.errors.get("sub_district")},on:{errors:function(e){return t.form.errors.set("sub_district",null)}},model:{value:t.form.sub_district,callback:function(e){t.$set(t.form,"sub_district",e)},expression:"form.sub_district"}}),e("p-form-row",{attrs:{id:"phone",name:"phone",label:t.$t("phone"),disabled:t.isSaving,errors:t.form.errors.get("phone")},on:{errors:function(e){return t.form.errors.set("phone",null)}},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}}),e("p-form-row",{attrs:{id:"similar-product",name:"similar_product",label:t._f("titlecase")(t.$t("similar product"))}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.similarProduct.open(t.form.similar_products)}}},[0==t.form.similar_products.length?[t._v(t._s(t._f("uppercase")(t.$t("select"))))]:t._e(),t._l(t.form.similar_products,(function(e,r){return[t._v(" "+t._s(t._f("uppercase")(e.name))),r+1!=t.form.similar_products.length?[t._v(",")]:t._e()]}))],2)])]),e("p-form-row",{attrs:{id:"interest",name:"interest",label:t._f("titlecase")(t.$t("interest reason"))}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.interestReason.open(t.form.interest_reasons)}}},[0==t.form.interest_reasons.length?[t._v(t._s(t._f("uppercase")(t.$t("select"))))]:t._e(),t._l(t.form.interest_reasons,(function(e,r){return[t._v(" "+t._s(t._f("uppercase")(e.name))),r+1!=t.form.interest_reasons.length?[t._v(",")]:t._e()]}))],2)])]),e("p-form-row",{attrs:{id:"no-interest",name:"no_interest",label:t.$t("no interest reason")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.noInterestReason.open(t.form.no_interest_reasons)}}},[0==t.form.no_interest_reasons.length?[t._v(t._s(t._f("uppercase")(t.$t("select"))))]:t._e(),t._l(t.form.no_interest_reasons,(function(e,r){return[t._v(" "+t._s(t._f("uppercase")(e.name))),r+1!=t.form.no_interest_reasons.length?[t._v(",")]:t._e()]}))],2)])]),e("p-form-row",{attrs:{id:"notes",name:"notes",label:"notes",disabled:t.isSaving,errors:t.form.errors.get("notes")},on:{errors:function(e){return t.form.errors.set("notes",null)}},model:{value:t.form.notes,callback:function(e){t.$set(t.form,"notes",e)},expression:"form.notes"}}),e("p-separator"),e("h5",[t._v(t._s(t._f("uppercase")(t.$t("form sales"))))]),e("hr"),e("p-form-row",{attrs:{label:t.$t("date")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("p-date-picker",{attrs:{id:"date",name:"date",label:"date",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",errors:t.form.errors.get("date")},on:{errors:function(e){return t.form.errors.set("date",null)}},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)]),e("hr"),e("p-form-row",{attrs:{label:t._f("titlecase")(t.$t("payment method"))}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("label",{staticClass:"css-control css-control-primary css-radio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.payment_method,expression:"form.payment_method"}],staticClass:"css-control-input",attrs:{type:"radio",name:"radio-group2"},domProps:{value:"cash",checked:t._q(t.form.payment_method,"cash")},on:{change:function(e){return t.$set(t.form,"payment_method","cash")}}}),e("span",{staticClass:"css-control-indicator"}),t._v(" Tunai ")]),e("label",{staticClass:"css-control css-control-primary css-radio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.payment_method,expression:"form.payment_method"}],staticClass:"css-control-input",attrs:{type:"radio",name:"radio-group2"},domProps:{value:"credit",checked:t._q(t.form.payment_method,"credit")},on:{change:function(e){return t.$set(t.form,"payment_method","credit")}}}),e("span",{staticClass:"css-control-indicator"}),t._v(" Tempo ")]),e("label",{staticClass:"css-control css-control-primary css-radio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.payment_method,expression:"form.payment_method"}],staticClass:"css-control-input",attrs:{type:"radio",name:"radio-group2"},domProps:{value:"taking-order",checked:t._q(t.form.payment_method,"taking-order")},on:{change:function(e){return t.$set(t.form,"payment_method","taking-order")}}}),e("span",{staticClass:"css-control-indicator"}),t._v(" Taking Order ")]),e("label",{staticClass:"css-control css-control-primary css-radio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.payment_method,expression:"form.payment_method"}],staticClass:"css-control-input",attrs:{type:"radio",name:"radio-group2"},domProps:{value:"sell-out",checked:t._q(t.form.payment_method,"sell-out")},on:{change:function(e){return t.$set(t.form,"payment_method","sell-out")}}}),e("span",{staticClass:"css-control-indicator"}),t._v(" Sell Out ")])])]),e("p-form-row",{directives:[{name:"show",rawName:"v-show",value:"credit"===t.form.payment_method,expression:"form.payment_method === 'credit'"}],attrs:{id:"date",name:"date",label:t.$t("due date")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("p-date-picker",{attrs:{id:"date",name:"date",label:"date",errors:t.form.errors.get("date")},on:{errors:function(e){return t.form.errors.set("date",null)}},model:{value:t.form.due_date,callback:function(e){t.$set(t.form,"due_date",e)},expression:"form.due_date"}})],1)]),e("p-form-row",{directives:[{name:"show",rawName:"v-show",value:"credit"===t.form.payment_method,expression:"form.payment_method === 'credit'"}],attrs:{label:t._f("titlecase")(t.$t("payment received"))}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"payment-received",name:"payment_received",disabled:t.isSaving,errors:t.form.errors.get("payment_received"),"is-text-right":!1},on:{errors:function(e){return t.form.errors.set("payment_received",null)}},model:{value:t.form.payment_received,callback:function(e){t.$set(t.form,"payment_received",e)},expression:"form.payment_received"}})],1)]),e("p-table",[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",[t._v("Item")]),e("th",[t._v("Jumlah")]),e("th",[t._v("Harga Satuan")]),e("th",[t._v("Total")])]),t._l(t.form.items,(function(r,o){return e("tr",{key:"row-"+o,attrs:{slot:"p-body"},slot:"p-body"},[e("td",[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.item.open(o)}}},[t._v(" "+t._s(t._f("uppercase")(r.item_label||t.$t("select")))+" ")])]),e("td",[e("p-quantity",{attrs:{id:"quantity"+o,name:"quantity"+o,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter},max:1*r.quantity_pending,readonly:t.onClickUnit(r)},on:{choosen:function(e){return t.chooseUnit(e,r)}},nativeOn:{click:function(e){return t.onClickQuantity(r,o)},keyup:function(e){return t.calculate.apply(null,arguments)}},model:{value:r.quantity,callback:function(e){t.$set(r,"quantity",e)},expression:"row.quantity"}})],1),e("td",[e("p-form-number",{attrs:{id:"price"+o,name:"price"+o,disabled:null==r.item_id},nativeOn:{keyup:function(e){return t.calculate.apply(null,arguments)}},model:{value:r.price,callback:function(e){t.$set(r,"price",e)},expression:"row.price"}})],1),e("td",[e("p-form-number",{attrs:{id:"total"+o,name:"total"+o,disabled:!0},model:{value:r.total,callback:function(e){t.$set(r,"total",e)},expression:"row.total"}})],1)])})),e("tr",{attrs:{slot:"p-body"},slot:"p-body"},[e("td"),e("td"),e("td",[t._v("Total")]),e("td",[e("p-form-number",{attrs:{readonly:!0,"is-text-right":!0},model:{value:t.form.total_price,callback:function(e){t.$set(t.form,"total_price",e)},expression:"form.total_price"}})],1)])],2),e("hr"),e("div",{staticClass:"form-group row"},[e("div",{staticClass:"col-md-12"},[e("button",{staticClass:"btn btn-sm btn-primary",attrs:{disabled:t.isSaving,type:"submit"}},[e("i",{directives:[{name:"show",rawName:"v-show",value:t.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),t._v(" "+t._s(t._f("uppercase")(t.$t("save")))+" ")])])])],1)],1),e("m-inventory-out",{ref:"inventory",attrs:{id:"inventory","disable-unit-selection":!0},on:{updated:function(e){return t.updateDna(e)}}}),e("m-warehouse",{ref:"warehouse",attrs:{id:"warehouse_id"},on:{choosen:function(e){return t.chooseWarehouse(e)}}}),e("m-customer",{ref:"customer",on:{choosen:t.chooseCustomer}}),e("m-customer-group",{ref:"group",on:{choosen:t.chooseGroup}}),e("m-item",{ref:"item",on:{choosen:function(e){return t.chooseItem(e)}}}),e("m-m-interest-reason",{ref:"interestReason",on:{choosen:function(e){return t.chooseInterestReason(e)}}}),e("m-m-no-interest-reason",{ref:"noInterestReason",on:{choosen:function(e){return t.chooseNoInterestReason(e)}}}),e("m-m-similar-product",{ref:"similarProduct",on:{choosen:function(e){return t.chooseSimilarProduct(e)}}})],1)},s=[],n=r("c7eb"),a=r("1da1"),i=r("5530"),l=(r("d3b7"),r("159b"),r("caad"),r("2532"),r("d81d"),r("14d9"),r("a4d3"),r("e01a"),r("4de4"),r("2ef0")),c=r("fabd"),m=r("5ae6"),u=r("bc27"),d=r("8e1a"),p=r("b7ae"),f=r("3c87"),h=r("a357"),_=r("6feb"),b=r("2f62"),g=r("bb36"),v={components:{TabMenu:c["a"],Breadcrumb:m["a"],BreadcrumbPlugin:u["a"],BreadcrumbPinPoint:d["a"],MMInterestReason:f["a"],MMNoInterestReason:h["a"],MMSimilarProduct:_["a"]},data:function(){return{mapboxApiKey:"",mapboxResult:{},isLoading:!1,loadingMessage:"Loading...",isSaving:!1,warehouseId:null,warehouseName:null,form:new p["a"]({date:this.serverDateTime(),image:null,customer_id:null,branch_id:null,warehouse_id:null,customer_name:this.$route.query.name||"",address:this.$route.query.address||"",district:this.$route.query.district||"",sub_district:this.$route.query.sub_district||"",latitude:this.$route.query.latitude||"",longitude:this.$route.query.longitude||"",group_id:null,group_name:null,phone:"",notes:"",interest_reasons:[],no_interest_reasons:[],similar_products:[],items:[],total_price:0,payment_method:"cash",due_date:null,received_payment:0}),center:{lat:23.8103,lng:90.4125},markers:[{position:{lat:10,lng:10}}],addressComponent:{},getMap:this.$root.mapping,description:"",latLng:{},place:null}},computed:Object(i["a"])({},Object(b["c"])("auth",["authUser"])),mounted:function(){var t=this;return Object(a["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isLoading=!1,t.loadingMessage="Searching current location",e.next=4,t.getLocation();case 4:case"end":return e.stop()}}),e)})))()},created:function(){this.addItemRow(),this.form.branch_id=this.authUser.branch.id,this.form.warehouse_id=this.authUser.warehouse.id,this.warehouseId=this.authUser.warehouse.id,this.warehouseName=this.authUser.warehouse.name},methods:Object(i["a"])(Object(i["a"])({},Object(b["b"])("pluginPinPointSalesVisitationForm",["create"])),{},{chooseWarehouse:function(t){this.warehouseId=t.id,this.warehouseName=t.name,this.form.warehouse_id=t.id},onClickQuantity:function(t,e){"sell-out"!=this.form.payment_method&&"taking-order"!=this.form.payment_method&&(1!=t.require_expiry_date&&1!=t.require_production_number||(t.warehouse_id=this.warehouseId,t.index=e,this.$refs.inventory.open(t,t.quantity)))},onClickUnit:function(t){return"sell-out"!=this.form.payment_method&&"taking-order"!=this.form.payment_method&&!(!t.item&&null!=t.item_id&&1!==t.require_expiry_date&&1!==t.require_production_number)},chooseUnit:function(t,e){e.unit=t.label,e.converter=t.converter},updateDna:function(t){console.log(t),this.form.items[t.index].dna=t.dna,this.form.items[t.index].quantity=t.quantity,this.form.items[t.index].unit=t.unit,this.form.items[t.index].converter=t.converter},onCaptured:function(t){this.form.image=t},getLocation:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var t=Object(a["a"])(Object(n["a"])().mark((function t(e){var r,o=this;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={lat:e.coords.latitude,lng:e.coords.longitude},this.center.lat=r.lat,this.center.lng=r.lng,t.next=5,g["a"].get("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(this.center.lng,",").concat(this.center.lat,".json?access_token=").concat(this.mapboxApiKey));case 5:this.mapboxResult=t.sent,this.setDescription(this.mapboxResult.data.features[0].place_name),this.form.address=this.mapboxResult.data.features[0].place_name,this.mapboxResult.data.features[0].context.forEach((function(t){t.id.includes("locality")&&(o.form.district=t.text),t.id.includes("neighborhood")&&(o.form.sub_district=t.text)})),this.form.latitude=r.lat,this.form.longitude=r.lng,this.markers[0].position.lat=r.lat,this.markers[0].position.lng=r.lng,this.$refs.map.$mapPromise.then((function(){o.isLoading=!1,o.geocodeLatLng(new google.maps.Geocoder,r,google.maps.InfoWindow)})).catch((function(t){o.isLoading=!1}));case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}().bind(this)):this.loadingMessage="Geolocation not available, please update your browser or using another browser"},addMoreSimilarProduct:function(){this.form.similar_products.push({id:null,name:null})},chooseCustomer:function(t){t.groups.length>=1&&(this.form.group_id=t.groups[0].id,this.form.group_name=t.groups[0].name),this.form.customer_id=t.id,this.form.customer_name=t.name},chooseGroup:function(t){this.form.group_id=t.id,this.form.group_name=t.name},setDescription:function(t){this.description=t},setPlace:function(t){var e=this;this.center.lat=t.geometry.location.lat(),this.center.lng=t.geometry.location.lng(),this.markers[0].position.lat=t.geometry.location.lat(),this.markers[0].position.lng=t.geometry.location.lng(),this.addressComponent=t,this.setDescription(this.addressComponent.formatted_address),this.form.address=this.addressComponent.formatted_address,this.form.district="",this.form.sub_district="",this.addressComponent.address_components.forEach((function(t){t.types&&t.types.forEach((function(r){"administrative_area_level_3"==r?e.form.district=t.long_name:"administrative_area_level_4"==r&&(e.form.sub_district=t.long_name)}))}))},geocodeLatLng:function(t,e,r){var o=this;t.geocode({location:this.center},(function(t,e){"OK"==e&&(o.addressComponent=t[0],o.setDescription(o.addressComponent.formatted_address),o.form.address=o.addressComponent.formatted_address,o.addressComponent.address_components.forEach((function(t){t.types&&t.types.forEach((function(e){"administrative_area_level_3"==e?o.form.district=t.long_name:"administrative_area_level_4"==e&&(o.form.sub_district=t.long_name)}))})))}))},addItemRow:function(){this.form.items.push({item_id:null,item_name:null,item_label:null,chart_of_account_id:null,chart_of_account_name:null,require_expiry_date:null,require_production_number:null,unit:null,converter:null,quantity:null,allocation_id:null,allocation_name:null,notes:null,more:!1,units:[{label:"",name:"",converter:null}]})},chooseItem:function(t){if(null!=t.id){var e=this.form.items[t.index];e.item=t,e.item_id=t.id,e.item_name=t.name,e.item_label=t.label,e.require_production_number=t.require_production_number,e.require_expiry_date=t.require_expiry_date,e.units=t.units,e.units.forEach((function(r,o){r.id==t.unit_default_sales&&(e.unit=r.label,e.converter=r.converter)}));var r=!0;this.form.items.forEach((function(t){null==t.item_id&&(r=!1)})),r&&this.addItemRow(),this.calculate()}else this.clearItem(t.index)},clearItem:function(t){t.item_id=null,t.item_name=null,t.item_label=null,t.unit=null,t.converter=null,t.quantity=null,t.price=null,t.allocation_id=null,t.notes=null,t.more=!1,t.units=[],this.form.items.length>1&&(this.form.items=this.form.items.filter((function(t){return null!==t.item_id})),this.addItemRow())},chooseInterestReason:function(t){this.form.interest_reasons=t},chooseNoInterestReason:function(t){this.form.no_interest_reasons=t},chooseSimilarProduct:function(t){this.form.similar_products=t},calculate:Object(l["debounce"])((function(t){var e=this;this.form.total_price=0,this.form.items.forEach((function(t){t.price>0&&t.quantity>0&&(t.total=t.quantity*t.price,e.form.total_price+=parseFloat(t.total))}))}),100),onSubmit:function(){var t=this;this.isSaving=!0,this.create(this.form).then((function(e){t.isSaving=!1,t.$notification.success("Create success"),t.$store.dispatch("accountRewardPoint/get"),t.$router.push("/plugin/pin-point/sales-visitation-form")})).catch((function(e){t.isSaving=!1,t.$notification.error(e.message),e.errors&&t.form.errors.record(e.errors)}))}})},y=v,w=r("2877"),$=Object(w["a"])(y,o,s,!1,null,null,null);e["default"]=$.exports}}]);
//# sourceMappingURL=chunk-2d0ddc4e.0b968ad8.js.map
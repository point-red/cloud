(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a792894e"],{"000a":function(e,t,s){},"208e":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("sales")))+" ")])},r=[],a=s("2877"),n={},o=Object(a["a"])(n,i,r,!1,null,null,null);t["a"]=o.exports},"70fe":function(e,t,s){"use strict";s.r(t);s("b0c0");var i=function(){var e=this,t=e._self._c;return t("div",[e.deliveryNote?t("breadcrumb",[t("breadcrumb-sales"),t("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales/delivery-note"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("delivery note")))+" ")]),t("span",{staticClass:"breadcrumb-item active"},[e._v(e._s(e._f("uppercase")(e.deliveryNote.form.number||e.deliveryNote.form.edited_number)))])],1):e._e(),t("sales-menu"),e.deliveryNote.form.number&&e.deliveryNote.form.request_approval_to?t("div",[t("p-show-form-approval-status",{attrs:{form:"sales delivery note","is-loading":e.isLoading,"is-proccess-approval":e.isProccessApproval,"approval-status":e.deliveryNote.form.approval_status,"approval-reason":e.deliveryNote.form.approval_reason,"approved-by":e.deliveryNote.form.request_approval_to.full_name,"cancellation-status":e.deliveryNote.form.cancellation_status,"close-status":e.deliveryNote.form.close_status},on:{onApprove:e.onApprove,onReject:e.onReject}}),t("p-show-form-cancellation-status",{attrs:{form:"sales delivery note","is-loading":e.isLoading,"is-proccess-approval":e.isProccessCancellationApproval,"approved-by":e.deliveryNote.form.request_approval_to.full_name,"cancellation-status":e.deliveryNote.form.cancellation_status,"close-status":e.deliveryNote.form.close_status,"cancellation-approval-reason":e.deliveryNote.form.cancellation_approval_reason,"request-cancellation-reason":e.deliveryNote.form.request_cancellation_reason},on:{onCancellationApprove:e.onCancellationApprove,onCancellationReject:e.onCancellationReject}})],1):e._e(),e.deliveryNote?t("div",{staticClass:"row"},[t("p-block",[t("p-block-inner",{attrs:{"is-loading":e.isLoading}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-12"},[e.deliveryNote.form.edited_number?t("h3",[e._v(" "+e._s(e._f("uppercase")(e.$t("archive")))+" ")]):e._e(),e.deliveryNote.form.number?t("div",{staticClass:"text-right"},[t("button",{staticClass:"mr-3 btn btn-sm btn-outline-secondary mr-5",attrs:{title:"Send Receipt Delivery Note",disabled:e.isSendingEmail},on:{click:function(){return e.$refs.formSendEmail.open()}}},[t("i",{class:{"fa fa-paper-plane":!e.isSendingEmail,"fa fa-asterisk fa-spin":e.isSendingEmail}})]),t("button",{staticClass:"mr-3 btn btn-sm btn-outline-secondary mr-5",attrs:{title:"Preview Receipt Delivery Note"},on:{click:function(t){return e.$refs.printPreview.open()}}},[t("i",{staticClass:"si si-printer"})]),t("router-link",{staticClass:"btn btn-sm btn-outline-secondary mr-5",attrs:{to:{name:"sales.delivery-note.create"}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("create")))+" ")]),e.actions.edit?t("router-link",{staticClass:"btn btn-sm btn-outline-secondary mr-5",attrs:{to:{name:"sales.delivery-note.edit",params:{id:e.deliveryNote.id}}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("edit")))+" ")]):e._e(),e.actions.delete?t("button",{staticClass:"btn btn-sm btn-outline-secondary mr-5",attrs:{disabled:e.isDeleting},on:{click:function(t){return e.$refs.formRequestDelete.open()}}},[t("i",{directives:[{name:"show",rawName:"v-show",value:e.isDeleting,expression:"isDeleting"}],staticClass:"fa fa-asterisk fa-spin"}),e._v(" "+e._s(e._f("uppercase")(e.$t("delete")))+" ")]):e._e()],1):e._e()])]),t("hr"),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"},[t("h4",[e._v(e._s(e._f("uppercase")(e.$t("delivery note"))))]),t("table",{staticClass:"table table-sm table-bordered"},[t("tr",[t("td",{staticClass:"font-weight-bold",attrs:{width:"150px"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("form number")))+" ")]),t("td",[e._v(e._s(e.deliveryNote.form.number||e.deliveryNote.form.edited_number))])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("date")))+" ")]),t("td",[e._v(e._s(e._f("dateFormat")(e.deliveryNote.form.date,"DD MMMM YYYY")))])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("reference")))+" ")]),t("td",[e._v(e._s(e.deliveryNote.delivery_order.form.number))])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("warehouse")))+" ")]),t("td",[e._v(e._s(e.deliveryNote.warehouse.name))])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("driver")))+" ")]),t("td",[e._v(e._s(e.deliveryNote.driver))])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("license plate")))+" ")]),t("td",[e._v(e._s(e.deliveryNote.license_plate))])])])]),t("div",{staticClass:"col-sm-6 text-right"},[t("h6",{staticClass:"mb-5"},[e._v(" "+e._s(e._f("uppercase")(e.authUser.tenant_name))+" ")]),e.deliveryNote.form.branch?[e._v(" "+e._s(e._f("uppercase")(e.deliveryNote.form.branch.address))+" "),e.deliveryNote.form.branch.phone?t("br"):e._e(),e._v(e._s(e._f("uppercase")(e.deliveryNote.form.branch.phone))+" ")]:e._e(),t("h6",{staticClass:"mt-30 mb-5"},[e._v(" "+e._s(e._f("uppercase")(e.$t("customer")))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.deliveryNote.customer_name))+" "),t("div",{staticStyle:{"font-size":"12px"}},[e._v(" "+e._s(e._f("uppercase")(e.deliveryNote.customer_address))+" "),e.deliveryNote.customer_phone?t("br"):e._e(),e._v(e._s(e.deliveryNote.customer_phone)+" "),e.deliveryNote.customer.email?t("br"):e._e(),e._v(e._s(e._f("uppercase")(e.deliveryNote.customer.email))+" ")])],2)]),t("hr"),t("point-table",{staticClass:"mt-20"},[t("tr",{attrs:{slot:"p-head"},slot:"p-head"},[t("th",{staticClass:"text-center"},[e._v(" # ")]),t("th",[e._v("Item")]),t("th",{staticClass:"text-right"},[e._v(" Quantity Remaining ")]),t("th",{staticClass:"text-right"},[e._v(" Quantity ")])]),e._l(e.items,(function(s,i){return[t("tr",{key:i,attrs:{slot:"p-body"},slot:"p-body"},[t("th",{staticClass:"text-center"},[e._v(" "+e._s(i+1)+" ")]),t("td",[e._v(e._s(s.label))]),t("td",{staticClass:"text-right"},[e._v(" "+e._s(e._f("numberFormat")(s.quantity_remaining))+" "+e._s(s.unit)+" ")]),t("td",{staticClass:"text-right"},[e._v(" "+e._s(e._f("numberFormat")(s.quantity))+" "+e._s(s.unit)+" ")])])]}))],2),t("div",{staticClass:"row mt-50"},[t("div",{staticClass:"col-sm-9"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("notes")))+" ")]),t("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(" "+e._s(e.deliveryNote.form.notes)+" ")]),t("div",{staticClass:"d-sm-block d-md-none mt-10"})]),t("div",{staticClass:"col-sm-3 text-center"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("requested by")))+" ")]),t("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[e._v(" "+e._s(e._f("dateFormat")(e.deliveryNote.form.date,"DD MMMM YYYY"))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.deliveryNote.form.created_by.full_name))+" "),t("div",{staticClass:"d-sm-block d-md-none mt-10"})])])],1)],1)],1):e._e(),t("m-form-request-delete",{ref:"formRequestDelete",on:{delete:function(t){return e.onDelete(t)}}}),t("m-form-send-email",{ref:"formSendEmail",attrs:{"email-to":e.deliveryNote.customer.email},on:{submit:function(t){return e.onSendEmail(t)}}}),t("m-print-preview",{ref:"printPreview",attrs:{"delivery-note":e.deliveryNote}})],1)},r=[],a=s("c7eb"),n=s("1da1"),o=s("5530"),c=(s("d3b7"),s("159b"),s("b64b"),s("14d9"),s("7db0"),s("bea4")),l=s("5ae6"),d=s("208e"),v=function(){var e=this,t=e._self._c;return t("sweet-modal",{ref:"print-preview",attrs:{title:e._f("uppercase")(e.$t("print delivery note")),"overlay-theme":"dark"},on:{close:function(t){return e.onClose()}}},[t("table",{staticClass:"print-delivery-note-container m-2 mb-4 mx-auto",attrs:{id:"print-delivery-note"}},[t("thead",[t("tr",[t("td",[t("div",{staticClass:"d-flex justify-content-between",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"110px",height:"110px","align-self":"center"}},[t("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.logoUrl,alt:"Logo"}})]),t("div",{staticClass:"company-detail"},[t("h1",{staticStyle:{"margin-top":"0","margin-bottom":"5px"}},[e._v(" Delivery Note ")]),t("h3",{staticClass:"my-5px",staticStyle:{"line-height":"22px"}},[e._v(" "+e._s(e.tenantName)+" ")]),t("p",{staticClass:"my-5px",staticStyle:{"line-height":"15px"}},[e._v(" "+e._s(e.tenantAddress)+" ")]),t("p",{staticClass:"my-5px"},[e._v(" "+e._s(e.tenantPhone)+" ")])])]),t("hr",{staticClass:"header-divider"}),t("div",{staticClass:"d-flex justify-content-between",staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("table",{staticClass:"header-detail",staticStyle:{"margin-right":"20px"}},[t("tr",[t("td",[e._v("Form Number")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e.deliveryNote.form.number))])]),t("tr",[t("td",[e._v("Date")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e._f("dateFormat")(e.deliveryNote.form.date,"DD MMMM YYYY")))])]),t("tr",[t("td",[e._v("Customer")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e.deliveryNote.customer.name||"-"))])]),t("tr",[t("td",[e._v("Driver")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e.deliveryNote.driver||"-"))])]),t("tr",[t("td",[e._v("License Plate")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e.deliveryNote.license_plate||"-"))])])]),t("table",{staticClass:"header-detail",staticStyle:{"margin-left":"20px"}},[t("tr",[t("td",[e._v("Address")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e.deliveryNote.customer.address||"-"))])]),t("tr",[t("td",[e._v("Phone number")]),t("td",[e._v(":")]),t("td",[e._v(e._s(e.deliveryNote.customer.phone||"-"))])]),t("tr",[t("td",{attrs:{colspan:"3"}},[e._v("   ")])]),t("tr",[t("td",{attrs:{colspan:"3"}},[e._v("   ")])]),t("tr",[t("td",{attrs:{colspan:"3"}},[e._v("   ")])])])])])])]),t("tbody",[t("tr",[t("td",[1==e.deliveryNote.form.cancellation_status?t("div",{staticClass:"watermark"},[t("img",{staticStyle:{opacity:"0.5",width:"100%"},attrs:{src:"/assets/img/draft-watermark.png"}})]):e._e(),t("table",{staticClass:"table-items",staticStyle:{width:"100%"}},[t("thead",[t("tr",[t("th",{staticClass:"text-center"},[e._v(" Item ")]),t("th",{staticClass:"text-center"},[e._v(" Quantity Delivered ")])])]),e._l(e.deliveryNote.items,(function(s,i){return t("tr",{key:i},[t("td",[e._v(" "+e._s(s.item.label)+" ")]),t("td",{staticClass:"text-center"},[e._v(" "+e._s(e._f("numberFormat")(s.quantity))+" "+e._s(s.unit)+" ")])])}))],2),t("div",{staticClass:"d-flex justify-content-end",staticStyle:{"margin-top":"75px"}},[t("div",{staticClass:"text-center",staticStyle:{"margin-right":"75px"}},[t("h3",[e._v("Driver")]),t("br"),t("br"),t("br"),e._v(" "+e._s(e.deliveryNote.driver)+" ")]),t("div",{staticClass:"text-center"},[t("h3",[e._v("Created By")]),t("br"),t("br"),t("br"),e._v(" "+e._s(e.deliveryNote.form.created_by.full_name)+" ")])])])])])]),t("div",{staticClass:"pull-right"},[t("button",{directives:[{name:"print",rawName:"v-print",value:"print-delivery-note",expression:"'print-delivery-note'"}],staticClass:"btn btn-sm btn-outline-secondary mt-3",attrs:{type:"button"},on:{click:e.createHistoryPrint}},[e._v(" "+e._s(e._f("uppercase")(e.$t("print")))+" ")])])])},u=[],p=(s("3ca3"),s("ddb0"),s("fa1a")),m=s("7b1d"),_=s.n(m),f=s("2f62"),h={directives:{print:_.a},props:{deliveryNote:{type:Object,required:!0}},data:function(){return{onLoad:!0,logoUrl:"",notes:""}},computed:{tenantName:function(){return localStorage.getItem("tenantName")},tenantAddress:function(){var e=localStorage.getItem("tenantAddress");return e&&"null"!==e||(e="-"),e},tenantPhone:function(){var e=localStorage.getItem("tenantPhone");return e&&"null"!==e||(e="-"),e}},created:function(){var e=this;return Object(n["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.onLoad=!0,t.next=3,Promise.all([e.getSettingLogo(),e.getSettingEndNote()]);case 3:e.onLoad=!1;case 4:case"end":return t.stop()}}),t)})))()},methods:Object(o["a"])(Object(o["a"])({},Object(f["b"])("salesDeliveryNoteHistory",["add"])),{},{clear:function(){this.mutableId=null,this.mutableLabel=null,this.$emit("choosen",""),this.close()},open:function(){this.$refs["print-preview"].open()},close:function(){this.$refs["select-"+this.id].close()},onClose:function(){this.$emit("close",!0)},createHistoryPrint:function(){var e=this;this.add({id:this.deliveryNote.id,activity:"Printed"}).catch((function(t){e.$notification.error(t.message),e.form.errors.record(t.errors)}))},getSettingLogo:function(){var e=this;return Object(n["a"])(Object(a["a"])().mark((function t(){var s,i;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p["a"].get("/setting/logo");case 3:s=t.sent,i=s.data.data,e.logoUrl=i.publicUrl,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getSettingEndNote:function(){var e=this;return Object(n["a"])(Object(a["a"])().mark((function t(){var s,i;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p["a"].get("/setting/end-note");case 3:s=t.sent,i=s.data.data,e.notes=i.salesInvoice,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()}})},y=h,b=(s("d8c0"),s("2877")),g=Object(b["a"])(y,v,u,!1,null,"4120883e",null),N=g.exports,C=s("feee"),w={components:{SalesMenu:c["a"],Breadcrumb:l["a"],BreadcrumbSales:d["a"],MPrintPreview:N,PointTable:C["a"]},data:function(){return{id:this.$route.params.id,isLoading:!1,isDeleting:!1,isProccessApproval:!1,isProccessCancellationApproval:!1,isSendingEmail:!1}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(f["c"])("salesDeliveryNote",["deliveryNote"])),Object(f["c"])("auth",["authUser"])),{},{actions:function(){var e=this.deliveryNote.form,t=0==e.done,s=!!e.number,i=null==e.close_status||1!=e.close_status,r=null==e.cancellation_status||1!=e.cancellation_status;return{edit:t&&i&&this.$permission.has("update sales delivery note"),delete:t&&s&&i&&r&&this.$permission.has("delete sales delivery note")}},items:function(){var e=[];return this.deliveryNote.items.forEach((function(t){var s=Object.keys(e).length;s&&e[s-1].id===t.item_id?e[s-1].quantity+=t.quantity:e.push({id:t.item_id,unit:t.unit,label:t.item.label,quantity:t.quantity,quantity_remaining:t.quantity_remaining})})),e}}),watch:{$route:function(e,t){e.params.id!=t.params.id&&(this.id=e.params.id,this.deliveryNoteRequest())}},created:function(){this.deliveryNoteRequest()},methods:Object(o["a"])(Object(o["a"])({},Object(f["b"])("salesDeliveryNote",{find:"find",delete:"delete",approve:"approve",reject:"reject",cancellationApprove:"cancellationApprove",cancellationReject:"cancellationReject"})),{},{toggleMore:function(){var e=this.deliveryNote.items.some((function(e,t){return!1===e.more}));this.deliveryNote.items.forEach((function(t){t.more=e}))},deliveryNoteRequest:function(){var e=this;this.isLoading=!0,this.find({id:this.id,params:{with_archives:!0,with_origin:!0,includes:"customer;warehouse;deliveryOrder.form;deliveryOrder.form.createdBy;deliveryOrder.form.requestApprovalTo;items.item;items.allocation;form.createdBy;form.requestApprovalTo;form.branch"}}).then((function(t){e.calculate()})).catch((function(t){e.$notification.error(t.message)})).finally((function(){e.isLoading=!1}))},calculate:function(){var e=0;this.deliveryNote.items.forEach((function(t){t.discount_percent>0?t.total=t.quantity*(t.price-t.price*t.discount_percent/100):t.discount_value>0?t.total=t.quantity*(t.price-t.discount_value):t.total=t.quantity*t.price,e+=parseFloat(t.total)})),this.deliveryNote.subtotal=e},onDelete:function(e){var t=this;this.isDeleting=!0,this.delete({id:this.id,data:{reason:e}}).then((function(e){t.isDeleting=!1,t.$notification.success("cancel success"),t.deliveryNoteRequest()})).catch((function(e){t.isDeleting=!1,t.$notification.error(e.message),t.form.errors.record(e.errors)}))},onApprove:function(){var e=this;this.isProccessApproval=!0,this.approve({id:this.id}).then((function(t){e.$notification.success("approve success"),e.deliveryNoteRequest()})).catch((function(t){e.$notification.error(null===t||void 0===t?void 0:t.message)})).finally((function(){e.isProccessApproval=!1}))},onReject:function(e){var t=this;this.isProccessApproval=!0,this.reject({id:this.id,reason:e}).then((function(e){t.$notification.success("reject success"),t.deliveryNoteRequest()})).catch((function(e){t.$notification.error(null===e||void 0===e?void 0:e.message)})).finally((function(){t.isProccessApproval=!1}))},onCancellationApprove:function(){var e=this;this.isProccessCancellationApproval=!0,this.cancellationApprove({id:this.id}).then((function(t){e.$notification.success("cancellation approved"),e.$router.push("/sales/delivery-note")})).catch((function(t){e.$notification.error(null===t||void 0===t?void 0:t.message)})).finally((function(){e.isProccessCancellationApproval=!1}))},onCancellationReject:function(e){var t=this;this.isProccessCancellationApproval=!0,this.cancellationReject({id:this.id,reason:e}).then((function(e){t.$notification.success("cancellation rejected"),t.deliveryNoteRequest()})).catch((function(e){t.$notification.error(null===e||void 0===e?void 0:e.message)})).finally((function(){t.isProccessCancellationApproval=!1}))},onSendEmail:function(e){var t=this;return Object(n["a"])(Object(a["a"])().mark((function s(){var i;return Object(a["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.isSendingEmail=!0,s.prev=1,i=Object(o["a"])(Object(o["a"])({},e),{},{subject:"Delivery Note Receipt",attachments:[{filename:"Delivery Note Receipt "+t.deliveryNote.form.number+".pdf",type:"pdf",view:"sales.delivery-note.delivery-note-receipt",view_data:{deliveryNote:t.deliveryNote}}]}),s.next=5,t.$store.dispatch("emailService/send",Object(o["a"])({},i));case 5:t.$notification.success("send receipt success"),s.next=12;break;case 8:s.prev=8,s.t0=s["catch"](1),t.$notification.error(s.t0.message),t.form.errors.record(s.t0.errors);case 12:return s.prev=12,t.isSendingEmail=!1,s.finish(12);case 15:case"end":return s.stop()}}),s,null,[[1,8,12,15]])})))()}})},x=w,j=Object(b["a"])(x,i,r,!1,null,null,null);t["default"]=j.exports},d8c0:function(e,t,s){"use strict";s("000a")}}]);
//# sourceMappingURL=chunk-a792894e.e64a2f63.js.map
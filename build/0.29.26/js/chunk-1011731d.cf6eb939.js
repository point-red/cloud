(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1011731d"],{"05ac":function(e,t,r){},"208e":function(e,t,r){"use strict";var s=function(){var e=this,t=e._self._c;return t("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("sales")))+" ")])},a=[],i=r("2877"),n={},o=Object(i["a"])(n,s,a,!1,null,null,null);t["a"]=o.exports},"34dc":function(e,t,r){"use strict";r.r(t);r("a9e3");var s=function(){var e=this,t=e._self._c;return t("div",[t("breadcrumb",[t("breadcrumb-sales"),t("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"sales.delivery-order.index"}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("delivery order")))+" ")]),t("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"sales.delivery-order.show",params:{id:e.id}}}},[e._v(" "+e._s(e._f("uppercase")(e.deliveryOrder.form.number))+" ")]),t("span",{staticClass:"breadcrumb-item active"},[e._v(e._s(e._f("uppercase")(e.$t("edit"))))])],1),t("sales-menu"),t("form",{on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("div",{staticClass:"row"},[t("p-block",[t("p-block-inner",{attrs:{"is-loading":e.isLoading}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"},[t("h4",[e._v(e._s(e._f("uppercase")(e.$t("delivery order"))))]),t("table",{staticClass:"table table-sm table-bordered"},[t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("form number")))+" ")]),t("td",[e._v(" "+e._s(e.deliveryOrder.form.number)+" ")])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("date")))+" ")]),t("td",[t("p-date-picker",{attrs:{id:"date",name:"date",label:e.$t("date"),"disabled-date-rule":e.disabledDateRule,errors:e.form.errors.get("date")},on:{errors:function(t){return e.form.errors.set("date",null)}},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("sales order")))+" ")]),t("td",[t("span",{staticClass:"select-link",on:{click:function(t){return e.$refs.selectSalesOrder.open()}}},[e.salesOrder&&null!=e.salesOrder.form.number?[e._v(" "+e._s(e.salesOrder.form.number)+" ")]:[e._v(" "+e._s(e._f("uppercase")(e.$t("select")))+" ")]],2)])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("warehouse")))+" ")]),t("td",[t("span",{staticClass:"select-link",on:{click:function(t){return e.$refs.warehouse.open()}}},[e._v(e._s(e._f("uppercase")(e.form.warehouse_name||e.$t("select"))))])])])])]),t("div",{staticClass:"col-sm-6 text-right"},[t("div",{staticClass:"mb-30"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.authUser.tenant_name))+" ")]),e.authUser.branch?[e._v(" "+e._s(e._f("uppercase")(e.authUser.branch.address))+" "),e.authUser.branch.address?t("br"):e._e(),e._v(" "+e._s(e._f("uppercase")(e.authUser.branch.phone))+" "),e.authUser.branch.phone?t("br"):e._e()]:e._e()],2),t("div",[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("to")))+": "+e._s(e._f("uppercase")(e.form.customer_name))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.form.customer_address))+" "),e.form.customer_address?t("br"):e._e(),e._v(" "+e._s(e.form.customer_phone)+" "),e.form.customer_phone?t("br"):e._e()])])]),t("hr"),t("point-table",[t("tr",{attrs:{slot:"p-head"},slot:"p-head"},[t("th",[e._v("#")]),t("th",{staticStyle:{"min-width":"120px"}},[e._v(" Item ")]),t("th",[e._v("Quantity Requested")]),t("th",[e._v("Quantity Delivered")]),t("th",[e._v("Quantity Remaining")])]),e._l(e.form.items,(function(r,s){return[t("tr",{key:s,attrs:{slot:"p-body"},slot:"p-body"},[t("th",[e._v(e._s(s+1))]),t("td",[e._v(e._s(e._f("uppercase")(r.item_label)))]),t("td",[t("p-quantity",{attrs:{id:"quantity_requested"+s,name:"quantity_requested"+s,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter},disabled:"",readonly:""},model:{value:r.quantity_requested,callback:function(t){e.$set(r,"quantity_requested",t)},expression:"row.quantity_requested"}})],1),t("td",{staticClass:"position-relative"},[t("p-quantity",{attrs:{id:"quantity_delivered"+s,name:"quantity_delivered"+s,max:Number(r.quantity_requested),min:0,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter},disabled:!r.item_id,"disable-unit-selection":""},on:{changed:function(t){return e.onQuantityChange(t,r)}},model:{value:r.quantity_delivered,callback:function(t){e.$set(r,"quantity_delivered",t)},expression:"row.quantity_delivered"}})],1),t("td",[t("p-quantity",{attrs:{id:"quantity_remaining"+s,name:"quantity_remaining"+s,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter},disabled:"",readonly:""},model:{value:r.quantity_remaining,callback:function(t){e.$set(r,"quantity_remaining",t)},expression:"row.quantity_remaining"}})],1)])]}))],2),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"5",placeholder:"Notes"},domProps:{value:e.form.notes},on:{input:function(t){t.target.composing||e.$set(e.form,"notes",t.target.value)}}})]),t("div",{staticClass:"col-sm-3 text-center"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("requested by")))+" ")]),t("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[e._v(" "+e._s(e._f("dateFormat")(Date.now(),"DD MMMM YYYY"))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.requestedBy))+" "),t("div",{staticClass:"d-sm-block d-md-none mt-10"})]),t("div",{staticClass:"col-sm-3 text-center"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("approved by")))+" ")]),t("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[e._v(" _______________ ")]),t("span",{staticClass:"select-link",on:{click:function(t){return e.$refs.approver.open()}}},[e._v(e._s(e._f("uppercase")(e.form.approver_name||e.$t("select"))))]),t("br"),t("span",{staticStyle:{"font-size":"9px"}},[e._v(e._s(e._f("uppercase")(e.form.approver_email)))])])]),t("hr"),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-12"},[t("hr"),t("button",{staticClass:"btn btn-block btn-sm btn-primary",attrs:{type:"submit",disabled:e.isSaving}},[t("i",{directives:[{name:"show",rawName:"v-show",value:e.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),e._v(" "+e._s(e._f("uppercase")(e.$t("update")))+" ")])])])],1)],1)],1)]),t("m-user",{ref:"approver",attrs:{permission:"approve sales order"},on:{choosen:e.chooseApprover}}),t("m-warehouse",{ref:"warehouse",attrs:{id:"warehouse",name:"warehouse","default-only":""},on:{choosen:e.chooseWarehouse}}),t("select-sales-order",{ref:"selectSalesOrder",on:{choosen:e.chooseSalesOrder}})],1)},a=[],i=r("c7eb"),n=r("1da1"),o=r("5530"),l=(r("d3b7"),r("159b"),r("7db0"),r("b0c0"),r("d81d"),r("4de4"),r("14d9"),r("bea4")),u=r("5ae6"),c=r("208e"),d=r("b7ae"),m=r("feee"),_=r("d623"),p=r("2f62"),f={components:{SalesMenu:l["a"],PointTable:m["a"],Breadcrumb:u["a"],BreadcrumbSales:c["a"],SelectSalesOrder:_["a"]},data:function(){return{isSaving:!1,isLoading:!1,requestedBy:localStorage.getItem("fullName"),salesOrder:null,form:new d["a"]({id:this.$route.params.id,increment_group:this.$moment().format("YYYYMM"),date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),warehouse_id:null,warehouse_name:null,customer_id:null,customer_name:null,customer_label:null,customer_address:null,customer_phone:null,customer_email:null,pricing_group_id:1,notes:null,items:[],request_approval_to:null,approver_name:null,approver_email:null,sales_order_id:null})}},computed:Object(o["a"])(Object(o["a"])({},Object(p["c"])("salesDeliveryOrder",["deliveryOrder"])),Object(p["c"])("auth",["authUser"])),watch:{"form.items":{handler:function(e){e.forEach((function(e){var t=Number(e.quantity_delivered)<=Number(e.quantity_requested)?e.quantity_delivered:e.quantity_requested;e.quantity_remaining=Number(e.quantity_requested)-Number(t)}))},deep:!0}},created:function(){var e=this;return Object(n["a"])(Object(i["a"])().mark((function t(){var r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isLoading=!0,t.prev=1,!e.deliveryOrder.form.number){t.next=6;break}return e.isLoading=!1,e.mapDeliveryOrderData(e.deliveryOrder),t.abrupt("return",!0);case 6:return t.next=8,e.find({id:e.$route.params.id,params:{includes:"customer;warehouse;salesOrder.form;form.requestApprovalTo;items.item.units"}});case 8:r=t.sent,e.mapDeliveryOrderData(r.data),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](1),console.log(t.t0),e.$notification.error(t.t0.message);case 16:return e.isLoading=!1,t.abrupt("return",!0);case 18:case"end":return t.stop()}}),t,null,[[1,12]])})))()},methods:Object(o["a"])(Object(o["a"])({},Object(p["b"])("salesDeliveryOrder",["find","update"])),{},{mapDeliveryOrderData:function(e){this.chooseApprover(e.form.request_approval_to),this.chooseCustomer(e.customer),this.chooseWarehouse(e.warehouse),this.salesOrder=e.sales_order,this.form.date=e.form.date,this.form.notes=e.notes,this.form.sales_order_id=e.sales_order_id,this.form.items=e.items,this.form.items.forEach((function(e){var t=e.quantity_requested-e.quantity_delivered;e.item_label=e.item.name,e.is_quantity_over=t<0,e.units=e.item.units}))},disabledDateRule:function(e){var t=this.$options.filters.dateFormat(e,"YYYY-MM-DD"),r=this.$options.filters.dateFormat(this.form.date,"YYYY-MM-DD");return t<r},chooseWarehouse:function(e){var t=this;this.form.warehouse_id=e.id,this.form.warehouse_name=e.name,this.form.items.forEach((function(e){e.warehouse_id=t.form.warehouse_id,e.warehouse_name=t.form.warehouse_name}))},chooseApprover:function(e){this.form.request_approval_to=e.id,this.form.approver_name=e.fullName||e.full_name,this.form.approver_email=e.email},chooseCustomer:function(e){this.form.customer_id=e.id,this.form.customer_name=e.name,this.form.customer_label=e.label,this.form.customer_address=e.address,this.form.customer_phone=e.phone,this.form.customer_email=e.email,this.form.pricing_group_id=e.pricing_group_id},chooseSalesOrder:function(e){this.salesOrder=e,this.form.sales_order_id=e.id,this.form.customer_id=e.customer.id,this.form.customer_name=e.customer.name,this.form.customer_label=e.customer.label,this.form.items=e.items.map((function(e){var t=e.quantity_remaining-e.quantity_remaining;return{sales_order_item_id:e.id,item_id:e.item_id,item_name:e.item.name,item_label:e.item.name,units:e.item.units,unit:e.unit_smallest||e.unit,converter:e.converter_smallest||e.converter,quantity_requested:e.quantity_remaining,quantity_delivered:e.quantity_remaining,quantity_remaining:t,is_quantity_over:t<0,notes:e.notes}}))},onSubmit:function(){var e=this;if(this.isSaving=!0,null==this.form.request_approval_to)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({request_approval_to:["Approver should not empty"]});this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.items=this.form.items.filter((function(e){return e.item_id})),this.update(this.form).then((function(t){e.isSaving=!1,e.$notification.success("update success"),Object.assign(e.$data,e.$options.data.call(e)),e.$router.push("/sales/delivery-order/"+t.data.id)})).catch((function(t){e.isSaving=!1,e.$notification.error(t.message),e.form.errors.record(t.errors)}))}})},h=f,v=r("2877"),b=Object(v["a"])(h,s,a,!1,null,null,null);t["default"]=b.exports},b7cc:function(e,t,r){"use strict";r("05ac")},d623:function(e,t,r){"use strict";r("b0c0");var s=function(){var e=this,t=e._self._c;return t("sweet-modal",{ref:"modal",attrs:{title:e._f("uppercase")("select sales order"),"overlay-theme":"dark"},on:{close:function(t){return e.onClose()}}},[t("p-form-input",{staticClass:"btn-block",attrs:{id:"search-text",name:"search-text",placeholder:"Search...",value:e.searchText},on:{input:e.filterSearch}}),t("hr"),t("p-block-inner",{attrs:{"is-loading":e.isLoading}},[t("point-table",[t("tr",{attrs:{slot:"p-head"},slot:"p-head"},[t("th",[e._v("Date Form")]),t("th",[e._v("Form Number")]),t("th",[e._v("Customer")]),t("th",{attrs:{width:"105px"}},[e._v(" Item ")]),t("th",{attrs:{width:"50px"}},[e._v(" Quantity Requested ")]),t("th",{attrs:{width:"50px"}},[e._v(" Quantity Remaining ")])]),e._l(e.salesOrders,(function(r,s){return e._l(r.items,(function(a,i){return t("tr",{key:"pr-"+s+"-i-"+i,staticClass:"list-group-item-action",staticStyle:{cursor:"pointer"},attrs:{slot:"p-body"},on:{click:function(t){return e.choose(r)}},slot:"p-body"},[t("th",[e._v(e._s(e._f("dateFormat")(r.form.created_at,"DD MMMM YYYY HH:mm")))]),t("td",[e._v(e._s(r.form.number))]),t("td",[e._v(e._s(r.customer.name))]),t("td",[e._v(e._s(a.item.name))]),t("td",[e._v(e._s(a.quantity))]),t("td",[e._v(e._s(a.quantity_remaining))])])}))}))],2),t("p-pagination",{attrs:{"current-page":e.currentPage,"last-page":e.lastPage},on:{updatePage:e.updatePage}})],1),e.searchText&&0==e.salesOrders.length&&!e.isLoading?t("div",{staticClass:"alert alert-info text-center"},[e._v(" "+e._s(e._f("capitalize")(e.$t("searching not found",[e.searchText])))+" ")]):e._e(),t("div",{staticClass:"pull-right"},[t("button",{staticClass:"btn btn-sm btn-outline-danger",attrs:{type:"button"},on:{click:function(t){return e.clear()}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("clear")))+" ")])])],1)},a=[],i=r("5530"),n=(r("a9e3"),r("d3b7"),r("b047")),o=r.n(n),l=r("feee"),u=r("2f62"),c={components:{PointTable:l["a"]},props:{id:{type:String,default:""},value:{type:[String,Number],default:""}},data:function(){return{index:null,searchText:"",currentPage:1,lastPage:1,limit:10,selected:{},isLoading:!1}},computed:Object(i["a"])({},Object(u["c"])("salesOrder",["salesOrders","pagination"])),updated:function(){this.lastPage=this.pagination.last_page},methods:Object(i["a"])(Object(i["a"])({},Object(u["b"])("salesOrder",["get"])),{},{filterSearch:o()((function(e){console.log({value:e}),this.searchText=e,this.currentPage=1,this.getSalesOrder()}),500),getSalesOrder:function(){var e=this;this.isLoading=!0,this.get({params:{join:"form,items,item,customer",fields:"sales_order.*",sort_by:"-form.number",group_by:"form.id",filter_form:"activePending;approvalApproved",filter_not_null:"form.number",filter_like:{"form.number":this.searchText,"customer.name":this.searchText,"item.code":this.searchText,"item.name":this.searchText,"sales_order_item.notes":this.searchText,"sales_order_item.quantity":this.searchText,"sales_order_item.price":this.searchText},includes:"customer;items.item.units;form.createdBy",remaining_delivery_order_info:1,limit:this.limit,page:this.currentPage}}).finally((function(){e.isLoading=!1}))},updatePage:function(e){this.currentPage=e,this.getSalesOrder()},clear:function(e){this.$emit("choosen",{id:null,form:{number:null}}),this.close()},choose:function(e){this.$emit("choosen",e),this.close()},open:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.index=e,this.getSalesOrder(),this.$refs.modal.open(),this.$refs.modal.$el.querySelector(".sweet-content-content").style.overflow="auto"},close:function(){this.$refs.modal.close()},onClose:function(){this.$emit("close",!0)}})},d=c,m=(r("b7cc"),r("2877")),_=Object(m["a"])(d,s,a,!1,null,"59faadc8",null);t["a"]=_.exports}}]);
//# sourceMappingURL=chunk-1011731d.cf6eb939.js.map
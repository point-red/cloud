(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-215c92eb"],{"208e":function(e,t,r){"use strict";var i=function(){var e=this,t=e._self._c;return t("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[e._v(" "+e._s(e._f("uppercase")(e.$t("sales")))+" ")])},s=[],a=r("2877"),n={},o=Object(a["a"])(n,i,s,!1,null,null,null);t["a"]=o.exports},"512a":function(e,t,r){"use strict";r("b0c0");var i=function(){var e=this,t=e._self._c;return t("sweet-modal",{ref:"modal",attrs:{title:e._f("uppercase")("select delivery order"),"overlay-theme":"dark"},on:{close:function(t){return e.onClose()}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search..."},domProps:{value:e.searchText},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()},input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),t("hr"),e.isLoading?t("div",[t("h3",{staticClass:"text-center"},[e._v(" Loading ... ")])]):t("div",{staticClass:"list-group push"},e._l(e.options,(function(r,i){return t("a",{key:"request-"+i,staticClass:"list-group-item list-group-item-action",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.choose(r)}}},[t("div",{staticClass:"d-flex justify-content-between align-items-center"},[t("div",[t("strong",[e._v(e._s(r.form.number))])]),t("div",{staticClass:"text-black-50 text-right",staticStyle:{"font-size":"0.8em"}},[e._v(" Created by "+e._s(r.form.created_by.name)),t("br"),e._v(" "+e._s(e._f("dateFormat")(r.form.created_at,"DD MMMM YYYY HH:mm"))+" ")])]),t("table",{staticClass:"table mb-0",staticStyle:{"font-size":"11px"}},e._l(r.items,(function(r,i){return t("tr",{key:"item-"+i},[r.quantity_delivered?t("td",{staticClass:"pl-0"},[e._v(" "+e._s(r.item.name)+" ")]):e._e(),r.quantity_delivered?t("td",{staticClass:"w-1 text-right text-nowrap"},[e._v(" "+e._s(r.quantity_delivered)+" "+e._s(r.unit)+" ")]):e._e()])})),0)])})),0),e.searchText&&0==e.options.length&&!e.isLoading?t("div",{staticClass:"alert alert-info text-center"},[e._v(" "+e._s(e._f("capitalize")(e.$t("searching not found",[e.searchText])))+" ")]):e._e(),t("div",{staticClass:"pull-right"},[t("button",{staticClass:"btn btn-sm btn-outline-danger",attrs:{type:"button"},on:{click:function(t){return e.clear()}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("clear")))+" ")])])])},s=[],a=r("5530"),n=(r("a9e3"),r("ac1f"),r("841c"),r("d3b7"),r("159b"),r("b64b"),r("b047")),o=r.n(n),u=r("2f62"),l={props:{id:{type:String,default:""},value:{type:[String,Number],default:""}},data:function(){return{index:null,searchText:"",options:[],selected:{},isLoading:!1}},computed:Object(a["a"])({},Object(u["c"])("masterItem",["items","pagination"])),watch:{searchText:o()((function(){this.search()}),300)},methods:Object(a["a"])(Object(a["a"])({},Object(u["b"])("salesDeliveryOrder",["get"])),{},{search:function(){var e=this;this.isLoading=!0,this.get({params:{join:"form,items,item",fields:"sales_delivery_order.*",sort_by:"-form.number",group_by:"form.id",filter_form:"activePending;approvalApproved",filter_not_null:"form.number",includes:"customer;warehouse;items.item.units;form.createdBy;deliveryNotes.items"}}).then((function(t){e.options=t.data;var r=t.data;Object.keys(r).forEach((function(t){if(r[t].delivery_notes.length){var i=r[t].delivery_notes[r[t].delivery_notes.length-1].items;Object.keys(i).forEach((function(s){Object.keys(r[t].items).forEach((function(a){i[s].item_id==r[t].items[a].item_id&&(e.options[t].items[a].quantity_delivered=i[s].quantity_remaining)}))}))}}))})).finally((function(){e.isLoading=!1}))},clear:function(e){this.$emit("choosen",{id:null,form:{number:null}}),this.close()},choose:function(e){this.$emit("choosen",e),this.close()},open:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.index=e,this.search(),this.$refs.modal.open()},close:function(){this.$refs.modal.close()},onClose:function(){this.$emit("close",!0)}})},c=l,d=(r("c44b"),r("2877")),m=Object(d["a"])(c,i,s,!1,null,"7227b576",null);t["a"]=m.exports},"522a":function(e,t,r){},"5aed":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("breadcrumb",[t("breadcrumb-sales"),t("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"sales.delivery-note.index"}}},[e._v(" "+e._s(e._f("uppercase")(e.$t("delivery note")))+" ")]),t("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"sales.delivery-note.show",params:{id:e.$route.params.id}}}},[e._v(" "+e._s(e._f("uppercase")(e.deliveryNote.form.number))+" ")]),t("span",{staticClass:"breadcrumb-item active"},[e._v(e._s(e._f("uppercase")(e.$t("edit"))))])],1),t("sales-menu"),t("form",{on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("div",{staticClass:"row"},[t("p-block",[t("p-block-inner",{attrs:{"is-loading":e.isLoading}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-6"},[t("h4",[e._v(e._s(e._f("uppercase")(e.$t("delivery note"))))]),t("table",{staticClass:"table table-sm table-bordered"},[t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("date")))+" ")]),t("td",[t("p-date-picker",{attrs:{id:"date",name:"date",label:e.$t("date"),"disabled-date-rule":e.disabledDateRule,errors:e.form.errors.get("date")},on:{errors:function(t){return e.form.errors.set("date",null)}},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("delivery order")))+" ")]),t("td",[t("span",[e._v(e._s(e.deliveryOrder.form.number))])])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("warehouse")))+" ")]),t("td",[t("span",[e._v(e._s(e._f("uppercase")(e.form.warehouse_name)))])])]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("driver")))+" ")]),t("td",[t("p-form-input",{attrs:{id:"driver",name:"driver",label:e.$t("driver"),errors:e.form.errors.get("driver")},on:{errors:function(t){return e.form.errors.set("driver",null)}},model:{value:e.form.driver,callback:function(t){e.$set(e.form,"driver",t)},expression:"form.driver"}})],1)]),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e._f("uppercase")(e.$t("license plate")))+" ")]),t("td",[t("p-form-input",{attrs:{id:"license plate",name:"license plate",label:e.$t("license plate"),errors:e.form.errors.get("license_plate")},on:{errors:function(t){return e.form.errors.set("license_plate",null)}},model:{value:e.form.license_plate,callback:function(t){e.$set(e.form,"license_plate",t)},expression:"form.license_plate"}})],1)])])]),t("div",{staticClass:"col-sm-6 text-right"},[t("div",{staticClass:"mb-30"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.authUser.tenant_name))+" ")]),e.authUser.branch?[e._v(" "+e._s(e._f("uppercase")(e.authUser.branch.address))+" "),e.authUser.branch.address?t("br"):e._e(),e._v(" "+e._s(e._f("uppercase")(e.authUser.branch.phone))+" "),e.authUser.branch.phone?t("br"):e._e()]:e._e()],2),t("div",[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("to")))+": "+e._s(e._f("uppercase")(e.form.customer_name))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.form.customer_address))+" "),e.form.customer_address?t("br"):e._e(),e._v(" "+e._s(e.form.customer_phone)+" "),e.form.customer_phone?t("br"):e._e()])])]),t("hr"),t("point-table",[t("tr",{attrs:{slot:"p-head"},slot:"p-head"},[t("th",[e._v("#")]),t("th",{staticStyle:{"min-width":"120px"}},[e._v(" Item ")]),t("th",[e._v("Quantity Remaining")]),t("th",[e._v("Quantity")])]),e._l(e.form.items,(function(r,i){return[t("tr",{key:i,class:{"d-none":0==r.quantity_requested},attrs:{slot:"p-body"},slot:"p-body"},[t("th",[e._v(e._s(i+1))]),t("td",[e._v(e._s(e._f("uppercase")(r.item_label)))]),t("td",[t("p-quantity",{attrs:{id:"quantity_remaining"+i,name:"quantity_remaining"+i,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter},disabled:"",readonly:""},model:{value:r.quantity_remaining,callback:function(t){e.$set(r,"quantity_remaining",t)},expression:"row.quantity_remaining"}})],1),t("td",[t("p-quantity",{attrs:{id:"quantity"+i,name:"quantity"+i,disabled:null==r.item_id,"item-id":r.item_id,units:r.units,unit:{name:r.unit,label:r.unit,converter:r.converter},max:1*r.quantity_pending,"disable-unit-selection":!0,readonly:e.onClickUnit(r)},on:{choosen:function(t){return e.chooseUnit(t,r)}},nativeOn:{click:function(t){return e.onClickQuantity(r,i)}},model:{value:r.quantity,callback:function(t){e.$set(r,"quantity",t)},expression:"row.quantity"}})],1)])]}))],2),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-9"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"5",placeholder:"Notes"},domProps:{value:e.form.notes},on:{input:function(t){t.target.composing||e.$set(e.form,"notes",t.target.value)}}})]),t("div",{staticClass:"col-sm-3 text-center"},[t("h6",{staticClass:"mb-0"},[e._v(" "+e._s(e._f("uppercase")(e.$t("requested by")))+" ")]),t("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[e._v(" "+e._s(e._f("dateFormat")(Date.now(),"DD MMMM YYYY"))+" ")]),e._v(" "+e._s(e._f("uppercase")(e.requestedBy))+" "),t("div",{staticClass:"d-sm-block d-md-none mt-10"})])]),t("hr"),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-12"},[t("hr"),t("button",{staticClass:"btn btn-block btn-sm btn-primary",attrs:{type:"submit",disabled:e.isSaving}},[t("i",{directives:[{name:"show",rawName:"v-show",value:e.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),e._v(" "+e._s(e._f("uppercase")(e.$t("save")))+" ")])])])],1)],1)],1)]),t("select-delivery-order",{ref:"selectDeliveryOrder",on:{choosen:e.chooseDeliveryOrder}}),t("m-inventory-out",{ref:"inventory",attrs:{id:"inventory","disable-unit-selection":!0},on:{updated:function(t){return e.updateDna(t)}}})],1)},s=[],a=r("c7eb"),n=r("1da1"),o=r("5530"),u=(r("d3b7"),r("159b"),r("a9e3"),r("7db0"),r("b0c0"),r("14d9"),r("c740"),r("4de4"),r("bea4")),l=r("5ae6"),c=r("208e"),d=r("b7ae"),m=r("feee"),_=r("512a"),f=r("2f62"),p={components:{SalesMenu:u["a"],PointTable:m["a"],Breadcrumb:l["a"],BreadcrumbSales:c["a"],SelectDeliveryOrder:_["a"]},data:function(){return{isSaving:!1,isLoading:!1,requestedBy:localStorage.getItem("fullName"),deliveryOrder:null,form:new d["a"]({id:this.$route.params.id,increment_group:this.$moment().format("YYYYMM"),date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),driver:null,license_plate:null,warehouse_id:null,warehouse_name:null,customer_id:null,customer_name:null,customer_label:null,customer_address:null,customer_phone:null,customer_email:null,pricing_group_id:1,need_down_payment:0,cash_only:!1,notes:null,discount_percent:0,discount_value:0,tax_base:0,tax:0,type_of_tax:"exclude",items:[],request_approval_to:null,approver_name:null,approver_email:null,delivery_order_id:null}),showNotif:!1}},computed:Object(o["a"])(Object(o["a"])({},Object(f["c"])("salesDeliveryNote",["deliveryNote"])),Object(f["c"])("auth",["authUser"])),watch:{"form.items":{handler:function(e){e.forEach((function(e){"undefined"===typeof e.quantity&&(e.quantity=0);var t=Number(e.quantity),r=Number(e.quantity_requested),i=r-t;t>r&&(e.quantity=r),e.quantity_remaining=isNaN(t)?r:i}))},deep:!0},"form.driver":{handler:function(e){this.maxInput("driver",e)},deep:!0},"form.license_plate":{handler:function(e){this.maxInput("license_plate",e)},deep:!0}},created:function(){var e=this;return Object(n["a"])(Object(a["a"])().mark((function t(){var r;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.prev=1,t.next=4,e.find({id:e.$route.params.id,params:{includes:"customer;warehouse;deliveryOrder.form;form.requestApprovalTo;items.item.units"}});case 4:r=t.sent,e.mapDeliveryNoteData(r.data),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.$notification.error(t.t0.message);case 11:return e.isLoading=!1,t.abrupt("return",!0);case 13:case"end":return t.stop()}}),t,null,[[1,8]])})))()},methods:Object(o["a"])(Object(o["a"])({},Object(f["b"])("salesDeliveryNote",["find","update"])),{},{mapDeliveryNoteData:function(e){this.chooseCustomer(e.customer),this.chooseWarehouse(e.warehouse),this.deliveryOrder=e.delivery_order,this.form.date=e.form.date,this.form.notes=e.notes,this.form.driver=e.driver,this.form.license_plate=e.license_plate,this.form.delivery_order_id=e.delivery_order_id,this.form.request_approval_to=this.deliveryOrder.form.request_approval_to;var t=[],r=0;e.items.forEach((function(e){e.item_label=e.item.name,e.item.units.forEach((function(t,r){t.id==e.item.unit_default&&(e.item.unit=t)}));var i=0;r!=e.item_id&&(t.push(e),r=e.item_id,i=Number(e.quantity));var s=t.length-1;t[s].quantity=i||t[s].quantity+Number(e.quantity),t[s].quantity_requested=t[s].quantity+Number(e.quantity_remaining),t[s].require_expiry_date=e.item.require_expiry_date,t[s].require_production_number=e.item.require_production_number,(e.item.require_expiry_date||e.item.require_production_number)&&(t[s].dna||(t[s].dna=[]),t[s].dna.push({item_id:e.item_id,quantity:Number(e.quantity),remaining:Number(e.quantity_remaining),production_number:e.production_number,expiry_date:e.expiry_date}))})),this.form.items=t},disabledDateRule:function(e){var t=this.$options.filters.dateFormat(e,"YYYY-MM-DD"),r=this.$options.filters.dateFormat(this.form.date,"YYYY-MM-DD");return t<r},chooseWarehouse:function(e){var t=this;this.form.warehouse_id=e.id,this.form.warehouse_name=e.name,this.form.items.forEach((function(e){e.warehouse_id=t.form.warehouse_id,e.warehouse_name=t.form.warehouse_name}))},chooseCustomer:function(e){this.form.customer_id=e.id,this.form.customer_name=e.name,this.form.customer_label=e.label,this.form.customer_address=e.address,this.form.customer_phone=e.phone,this.form.customer_email=e.email,this.form.pricing_group_id=e.pricing_group_id},chooseUnit:function(e,t){var r=this;if(t.unit=e.label,t.converter=e.converter,e.prices&&e.prices.length>0){var i=e.prices.findIndex((function(e){return e.id===r.form.pricing_group_id}));t.price=parseFloat(e.prices[i].pivot.price),t.discount_value=parseFloat(e.prices[i].pivot.discount_value),t.discount_percent=parseFloat(e.prices[i].pivot.discount_percent)}},updateDna:function(e){this.form.items[e.index].dna=e.dna,this.form.items[e.index].quantity=e.quantity,this.form.items[e.index].unit=e.unit,this.form.items[e.index].converter=e.converter},chooseDeliveryOrder:function(e){var t=e.items.filter((function(e){return e.quantity_delivered}));if(t.length<=0)return this.$notification.error("Can not load form "+e.form.number+", because there is no item or quantity item is 0"),!1;this.form.items=e.items.filter((function(e){return e.item.units.forEach((function(t,r){t.id==e.item.unit_default&&(e.item.unit=t)})),{item:e.item,delivery_order_item_id:e.id,item_id:e.item_id,item_name:e.item.name,item_label:e.item.name,more:!1,unit:e.unit,converter:e.converter,quantity:e.quantity,quantity_requested:e.quantity_delivered,require_expiry_date:e.item.require_expiry_date,require_production_number:e.item.require_production_number,price:e.price,discount_percent:0,discount_value:0,total:e.quantity*(e.price-e.discount_value),allocation_id:e.allocation_id,allocation_name:e.allocation_name,notes:e.notes}}))},onSubmit:function(){var e=this;if(this.isSaving=!0,null==this.form.request_approval_to)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({request_approval_to:["Approver should not empty"]});this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.subtotal=this.subtotal,this.form.tax_base=this.tax_base,this.form.tax=this.tax,this.form.total=this.total,this.form.items=this.form.items.filter((function(e){return e.item_id})),this.update(this.form).then((function(t){e.isSaving=!1,e.$notification.success("create success"),Object.assign(e.$data,e.$options.data.call(e)),e.$router.push("/sales/delivery-note/"+t.data.id)})).catch((function(t){e.isSaving=!1,e.$notification.error(t.message),e.form.errors.record(t.errors)}))},onClickQuantity:function(e,t){1!=e.require_expiry_date&&1!=e.require_production_number||(e.warehouse_id=this.form.warehouse_id,e.index=t,e.max_input=Number(e.quantity_remaining)+Number(e.quantity),this.$refs.inventory.open(e,e.quantity))},onClickUnit:function(e){return null==e.item_id||1===e.require_expiry_date||1===e.require_production_number},maxInput:function(e,t){var r=this,i=255;t.length>i&&setTimeout((function(){r.form[e]=t.substring(0,i),r.showNotif||(r.showNotif=!0,r.$notification.error("max input "+i+" characters"),setTimeout((function(){r.showNotif=!1}),6e3))}),1)}})},h=p,v=r("2877"),b=Object(v["a"])(h,i,s,!1,null,null,null);t["default"]=b.exports},c44b:function(e,t,r){"use strict";r("522a")}}]);
//# sourceMappingURL=chunk-215c92eb.50574611.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40f0d124"],{"0a9d":function(t,e,n){"use strict";n("d162")},"0f45":function(t,e,n){"use strict";n.r(e);var r=n("ade3"),i=(n("b0c0"),n("14d9"),function(){var t=this,e=t._self._c;return e("div",[e("breadcrumb",[e("breadcrumb-plugin"),e("breadcrumb-play-book"),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")("Instruction")))])],1),e("div",{staticClass:"row"},[e("p-block",[t.isDirty?e("div",{staticClass:"alert alert-warning pb-5"},[t._v(" This is preview mode. Some of the contents is not published. ")]):t._e(),e("div",{staticClass:"input-group block mb-5"},[t.$permission.has("create play book instruction")?e("button",{staticClass:"btn btn-sm btn-light",attrs:{disabled:!t.form.procedure_id},on:{click:function(e){return t.$refs.modalAddInstruction.open()}}},[t._v(" ADD INSTRUCTION "),e("i",{staticClass:"fa fa-plus ml-2"})]):t._e(),t.$permission.has("create play book instruction")?e("button",{staticClass:"btn btn-sm btn-light ml-2",attrs:{disabled:!(t.form.procedure_id&&t.form.instruction_id)},on:{click:function(e){return t.$refs.modalAddStep.open()}}},[t._v(" ADD STEP "),e("i",{staticClass:"fa fa-plus ml-2"})]):t._e(),t.isDirty?e("router-link",{staticClass:"btn btn-sm btn-primary ml-2",attrs:{to:"/plugin/play-book/approval/instruction/send"}},[t._v(" Send Approval "),e("i",{staticClass:"fa fa-paper-plane"})]):t._e()],1),e("div",{staticClass:"mt-3"},[e("p-form-row",{attrs:{id:"procedure",name:"procedure",label:t.$t("procedure")}},[e("div",{staticClass:"col-lg-9",attrs:{slot:"body"},slot:"body"},[e("p-select",{attrs:{id:"procedure",name:"procedure",options:t.procedures},model:{value:t.form.procedure_id,callback:function(e){t.$set(t.form,"procedure_id",e)},expression:"form.procedure_id"}})],1)]),e("p-form-row",{attrs:{id:"instruction",name:"instruction",label:t.$t("instruction")}},[e("div",{staticClass:"col-lg-9 d-flex",attrs:{slot:"body"},slot:"body"},[e("p-select",{key:t.selectInstructionKey,attrs:{id:"instruction",name:"instruction",options:t.instructions},model:{value:t.form.instruction_id,callback:function(e){t.$set(t.form,"instruction_id",e)},expression:"form.instruction_id"}}),t.instruction?e("div",[t.$permission.has("update play book instruction")?e("button",{staticClass:"btn btn-light ml-2",on:{click:function(e){return t.$refs.modalEditInstruction.open()}}},[t._v(" Edit ")]):t._e(),t.$permission.has("delete play book instruction")?e("button",{staticClass:"btn btn-light ml-2",on:{click:t.confirmDeleteInstruction}},[t._v(" Delete ")]):t._e()]):t._e()],1)])],1),t.instruction?e("p-block-inner",{attrs:{"is-loading":t.isLoading}},[e("div",{staticClass:"text-right"},[t.stepActive.id?e("button",{staticClass:"btn btn-sm btn-light mr-1",on:{click:function(e){return e.stopPropagation(),t.$refs.modalEditStep.open()}}},[t._v(" Edit ")]):t._e(),t.stepActive.id?e("button",{staticClass:"btn btn-sm btn-light",on:{click:function(e){return e.stopPropagation(),t.confirmDeleteStep()}}},[t._v(" Delete ")]):t._e(),e("router-link",{staticClass:"btn btn-sm btn-light",attrs:{to:"/plugin/play-book/instruction/".concat(t.instruction.id,"/histories")}},[t._v(" See Histories ")])],1),e("hr"),e("point-table",[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",{attrs:{width:"50px"}},[t._v(" # ")]),e("th",[t._v("Step")]),t._l(t.glossaries,(function(n){return e("th",{key:n.id},[t._v(" "+t._s(n.name)+" ")])})),t.$route.query["review[]"]?e("th",{staticClass:"text-center"},[t._v(" Action ")]):t._e()],2),t._l(t.steps,(function(n,i){return e("tr",{key:i,class:{"bg-primary text-white":t.stepActive.id===n.id},attrs:{slot:"p-body"},slot:"p-body"},[e("td",[e("strong",[t._v(t._s(++i+(t.page-1)*t.limit))])]),e("td",[n.approved_at?e("a",{style:Object(r["a"])({},t.stepActive.id===n.id?"color":null,"white"),attrs:{href:"javascript:void(0)"},on:{click:function(e){return e.stopPropagation(),t.setStepActive(n)}}},[t._v(" "+t._s(n.name)+" ")]):"destroy"!==n.approval_action?e("span",{staticClass:"text-success"},[t._v(" "+t._s(n.name)+" ")]):e("strike",{staticClass:"text-danger"},[t._v(" "+t._s(n.name)+" ")])],1),t._l(t.glossaries,(function(r){return e("td",{key:r.id,domProps:{innerHTML:t._s(t.$sanitize(n.contentsForView["".concat(r.id)]||"-"))}},[n.approved_at?e("div",{domProps:{innerHTML:t._s(n.contentsForView["".concat(r.id)]||"-")}}):"destroy"!==n.approval_action?e("div",{staticClass:"text-success",domProps:{innerHTML:t._s(n.contentsForView["".concat(r.id)]||"-")}}):e("strike",{staticClass:"text-danger",domProps:{innerHTML:t._s(n.contentsForView["".concat(r.id)]||"-")}})],1)})),t.$route.query["review[]"]?e("td",{staticClass:"text-center"},[n.approved_at||n.approval_request_to!==t.authUser.id||n.declined_at?t._e():e("button",{staticClass:"btn btn-sm btn-secondary",attrs:{type:"button"},on:{click:function(e){t.stepIdToDelete=n.id,t.$refs.modalDeclineInstructionStep.open()}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("decline")))+" ")]),n.approved_at||n.approval_request_to!==t.authUser.id||n.declined_at?t._e():e("button",{staticClass:"btn btn-sm btn-success ml-2",attrs:{type:"submit",disabled:t.isSaving===n.id},on:{click:function(e){return t.approveStep(n)}}},[e("i",{directives:[{name:"show",rawName:"v-show",value:t.isSaving===n.id,expression:"isSaving === step.id"}],staticClass:"fa fa-asterisk fa-spin"}),t._v(" "+t._s(t._f("uppercase")(t.$t("approve")))+" ")])]):t._e()],2)}))],2)],1):t._e(),e("p-pagination",{attrs:{"current-page":t.page,"last-page":t.lastPage},on:{updatePage:t.updatePage}})],1)],1),e("m-add-instruction",{ref:"modalAddInstruction",attrs:{"procedure-id":parseInt(t.form.procedure_id)},on:{added:function(e){return t.$router.push("/plugin/play-book/approval/instruction/send")}}}),e("m-edit-instruction",{ref:"modalEditInstruction",attrs:{instruction:t.instruction},on:{added:function(e){return t.$router.push("/plugin/play-book/approval/instruction/send")}}}),e("m-add-instruction-step",{ref:"modalAddStep",attrs:{"instruction-id":parseInt(t.form.instruction_id)},on:{added:function(e){t.isDirty=!0,t.getSteps()}}}),e("m-edit-instruction-step",{ref:"modalEditStep",attrs:{step:t.stepActive},on:{added:function(e){t.isDirty=!0,t.getSteps()}}}),e("m-decline-instruction-step",{ref:"modalDeclineInstructionStep",attrs:{"instruction-id":t.form.instruction_id,"instruction-step-id":t.stepIdToDelete},on:{added:function(e){return t.getSteps()}}})],1)}),s=[],o=n("c7eb"),a=n("1da1"),c=n("5530"),u=(n("ac1f"),n("841c"),n("d3b7"),n("25f0"),n("159b"),n("7db0"),n("4de4"),n("d81d"),n("99af"),n("5319"),n("5ae6")),p=n("bc27"),l=n("26e9"),d=n("feee"),f=n("2f62"),b={components:{Breadcrumb:u["a"],BreadcrumbPlugin:p["a"],BreadcrumbPlayBook:l["a"],PointTable:d["a"]},data:function(){return{isLoading:!0,isSaving:!1,searchText:this.$route.query.search,page:1*this.$route.query.page||1,limit:10,lastPage:1,isAdvanceFilter:!1,statusId:this.$route.query.statusId,statusLabel:null,form:{procedure_id:null,instruction_id:null},isDirty:this.$route.query.dirty,stepActive:{},selectInstructionKey:(new Date).toString(),stepIdToDelete:null}},computed:Object(c["a"])(Object(c["a"])(Object(c["a"])({},Object(f["e"])("pluginPlayBookInstruction",["pagination"])),Object(f["c"])("auth",["authUser"])),{},{glossaries:function(){var t=[];return this.instruction&&this.$store.getters["pluginPlayBookInstruction/steps"].forEach((function(e){e.contents.forEach((function(e){t.find((function(t){return t===e.glossary_id}))||t.push(e.glossary_id)}))})),this.$store.getters["pluginPlayBookGlossary/glossaries"].filter((function(e){return t.find((function(t){return parseInt(t)===e.id}))}))},procedures:function(){try{return this.$store.getters["pluginPlayBookProcedure/allProcedures"](this.$store.getters["pluginPlayBookProcedure/procedures"]).map((function(t){return{id:t.id,label:"".concat(t.code," - ").concat(t.name)}}))}catch(t){return[]}},instructions:function(){return this.$store.getters["pluginPlayBookInstruction/instructions"].map((function(t){return{id:t.id,label:"".concat(t.number," - ").concat(t.name)}}))},instruction:function(){var t=this,e=this.$store.getters["pluginPlayBookInstruction/instructions"].find((function(e){return parseInt(e.id)===parseInt(t.form.instruction_id)}));return e?Object(c["a"])({},e):null},steps:function(){return this.instruction?this.$store.getters["pluginPlayBookInstruction/steps"].map((function(t){var e={};return t=Object(c["a"])({},t),t.contents.forEach((function(t){e["".concat(t.glossary_id)]=t.content})),t.contentsForView=e,t})):[]}}),watch:{"form.procedure_id":function(t){this.getInstructions();var e=this.$route.query;parseInt(this.$route.query.procedure)!==parseInt(this.form.procedure_id)&&this.$router.replace({query:Object(c["a"])(Object(c["a"])({},e),{},{procedure:t})})},"form.instruction_id":function(t){var e=Object(c["a"])(Object(c["a"])({},this.$route.query),{},{instruction:t});t||delete e.instruction,parseInt(this.$route.query.procedure)===parseInt(this.form.procedure_id)&&parseInt(this.$route.query.instruction)===parseInt(this.form.instruction_id)||this.$router.replace({query:e})},"$route.query.procedure":function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getInstructions();case 2:case"end":return e.stop()}}),e)})))()},"$route.query.instruction":function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getSteps();case 2:case"end":return e.stop()}}),e)})))()}},mounted:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("pluginPlayBookGlossary/get"),e.next=3,t.getProcedures();case 3:if(!t.$route.query.procedure){e.next=9;break}return t.form.procedure_id=t.$route.query.procedure,e.next=7,t.getInstructions();case 7:t.form.instruction_id=t.$route.query.instruction,t.getSteps();case 9:window.addEventListener("click",t.setStepActive);case 10:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){window.removeEventListener("click",this.setStepActive)},updated:function(){this.lastPage=this.pagination.last_page},methods:{getProcedures:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoading=!0,t.$store.commit("pluginPlayBookProcedure/SET_PROCEDURES",[]),t.$store.commit("pluginPlayBookInstruction/SET_INSTRUCTIONS",[]),e.next=6,t.$store.dispatch("pluginPlayBookProcedure/get",{search:t.searchText,limit:100});case 6:e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:return e.prev=10,t.isLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,8,10,13]])})))()},getInstructions:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("pluginPlayBookInstruction/get",{procedure_id:t.form.procedure_id});case 2:t.selectInstructionKey=(new Date).toString();case 3:case"end":return e.stop()}}),e)})))()},getSteps:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoading=!0,n=t.$route.query["review[]"],Array.isArray(n)||(n=[n]),e.next=6,t.$store.dispatch("pluginPlayBookInstruction/getSteps",{page:t.page,limit:10,instruction_id:t.instruction.id,is_dirty:t.isDirty||null,review:n});case 6:t.stepActive={},e.next=11;break;case 9:e.prev=9,e.t0=e["catch"](0);case 11:return e.prev=11,t.isLoading=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,9,11,14]])})))()},updatePage:function(t){this.page=t,this.getSteps()},setStepActive:function(t){t.instruction_id||(t={}),this.stepActive=t||{}},confirmDeleteInstruction:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n="".concat(t.$t("delete"),' Instruction "').concat(t.instruction.name,'"'),t.$alert.confirm(n,t.$t("confirmation delete message")).then(function(){var e=Object(a["a"])(Object(o["a"])().mark((function e(n){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoading=!0,t.isDeleteing=!0,e.next=5,t.$store.dispatch("pluginPlayBookInstruction/delete",t.instruction.id);case 5:t.$router.push("/plugin/play-book/approval/instruction/send"),e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:return e.prev=10,t.isDeleteing=!1,t.isLoading=!1,e.finish(10);case 14:case"end":return e.stop()}}),e,null,[[0,8,10,14]])})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})))()},confirmDeleteStep:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n="".concat(t.$t("delete"),' Step "').concat(t.stepActive.name,'"'),t.$alert.confirm(n,t.$t("confirmation delete message")).then(function(){var e=Object(a["a"])(Object(o["a"])().mark((function e(n){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoading=!0,t.isDeleteing=!0,e.next=5,t.$store.dispatch("pluginPlayBookInstruction/deleteStep",t.stepActive);case 5:t.isDirty=!0,t.getSteps(),e.next=11;break;case 9:e.prev=9,e.t0=e["catch"](0);case 11:return e.prev=11,t.isDeleteing=!1,t.isLoading=!1,e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[0,9,11,15]])})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})))()},approveStep:function(t){var e=this;return Object(a["a"])(Object(o["a"])().mark((function n(){return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e.isSaving=t.id,n.next=4,e.$store.dispatch("pluginPlayBookInstructionApproval/approveStep",t);case 4:e.getSteps(),n.next=9;break;case 7:n.prev=7,n.t0=n["catch"](0);case 9:return n.prev=9,e.isSaving=!1,n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[0,7,9,12]])})))()}}},v=b,h=(n("0a9d"),n("2877")),m=Object(h["a"])(v,i,s,!1,null,null,null);e["default"]=m.exports},"26e9":function(t,e,n){"use strict";var r=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/plugin/play-book"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("play book")))+" ")])},i=[],s=n("2877"),o={},a=Object(s["a"])(o,r,i,!1,null,null,null);e["a"]=a.exports},d162:function(t,e,n){}}]);
//# sourceMappingURL=chunk-40f0d124.8ed7110e.js.map
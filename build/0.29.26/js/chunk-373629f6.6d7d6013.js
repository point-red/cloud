(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-373629f6"],{"208e":function(t,e,o){"use strict";var a=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales")))+" ")])},n=[],s=o("2877"),r={},i=Object(s["a"])(r,a,n,!1,null,null,null);e["a"]=i.exports},"4e86":function(t,e,o){},bb89:function(t,e,o){"use strict";o("4e86")},c804:function(t,e,o){"use strict";o.r(e);o("e6e1"),o("a9e3");var a=function(){var t=this,e=t._self._c;return e("div",[e("breadcrumb",[e("breadcrumb-sales"),e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales/payment-collection"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("payment collection")))+" ")]),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")(t.$t("create"))))])],1),e("sales-menu"),e("form",{staticClass:"row",on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("p-block",{attrs:{title:t.$t("payment collection")}},[e("p-block-inner",{attrs:{"is-loading":t.isLoading}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("h4",[t._v(t._s(t._f("uppercase")(t.$t("payment collection"))))]),e("table",{staticClass:"table table-sm table-bordered"},[e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("date")))+" ")]),e("td",[e("p-date-picker",{attrs:{id:"date",name:"date",label:"payment date",errors:t.form.errors.get("date")},on:{errors:function(e){return t.form.errors.set("date",null)}},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)]),e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("payment methode")))+" ")]),e("td",[e("p-form-check-box",{staticClass:"mb-0",staticStyle:{float:"left"},attrs:{id:"payment-methode",name:"payment-methode",checked:"cash"==t.form.payment_type,description:t._f("uppercase")(t.$t("cash"))},nativeOn:{click:function(e){return t.choosePaymentType("cash")}}}),e("p-form-check-box",{staticClass:"mb-0",attrs:{id:"payment-type",name:"payment-type",checked:"bank"==t.form.payment_type,description:t._f("uppercase")(t.$t("bank"))},nativeOn:{click:function(e){return t.choosePaymentType("bank")}}})],1)])])]),e("div",{staticClass:"col-sm-6 text-right"},[e("div",{staticClass:"mb-30"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.authUser.tenant_name))+" ")]),t.authUser.branch?[t._v(" "+t._s(t._f("uppercase")(t.authUser.branch.address))+" "),t.authUser.branch.address?e("br"):t._e(),t._v(" "+t._s(t._f("uppercase")(t.authUser.branch.phone))+" "),t.authUser.branch.phone?e("br"):t._e()]:t._e()],2),e("div",[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("to")))+": "),e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.customers.open()}}},[t._v(t._s(t._f("uppercase")(t.form.customer_label||t.$t("select"))))])]),t._v(" "+t._s(t._f("uppercase")(t.form.customer_address))+" "),t.form.customer_address?e("br"):t._e(),t._v(" "+t._s(t.form.customer_phone)+" "),t.form.customer_phone?e("br"):t._e()])])]),t.form.references?e("div",[e("ul",{staticClass:"nav nav-tabs nav-tabs-alt mb-10",attrs:{"data-toggle":"tabs",role:"tablist"}},[e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",class:{active:"invoice"==t.choosen},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.choose("invoice")}}},[t._v(t._s(t._f("uppercase")(t.$t("invoice"))))])]),e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",class:{active:"down-payment"==t.choosen},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.choose("down-payment")}}},[t._v(t._s(t._f("uppercase")(t.$t("down payment"))))])]),e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",class:{active:"sales-return"==t.choosen},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.choose("sales-return")}}},[t._v(t._s(t._f("uppercase")(t.$t("sales return"))))])]),e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",class:{active:"other"==t.choosen},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.choose("other")}}},[t._v(t._s(t._f("uppercase")(t.$t("other"))))])])]),e("point-table",{directives:[{name:"show",rawName:"v-show",value:"invoice"===t.choosen,expression:"choosen === 'invoice'"}]},[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",{attrs:{width:"50px"}},[e("p-form-check-box",{staticClass:"text-center",attrs:{id:"subscibe",name:"subscibe",checked:t.isRowsChecked(t.form.references.salesInvoice,t.checkedRow[0]),"is-form":!1},nativeOn:{click:function(e){return t.toggleCheckRows(0)}}})],1),e("th",[t._v("Date")]),e("th",[t._v("Form Number")]),e("th",[t._v("Notes")]),e("th",[t._v("Available Invoice")]),e("th",[t._v("Amount Collection")])]),t._l(t.form.references.salesInvoice,(function(o,a){return[e("tr",{key:a,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[e("p-form-check-box",{staticClass:"text-center",attrs:{id:"subscibe","is-form":!1,name:"subscibe",checked:t.isRowChecked(0,o.id)},nativeOn:{click:function(e){return t.toggleCheckRow(0,o.id)}}})],1),e("td",[t._v(" "+t._s(t._f("dateFormat")(o.date,"DD MMMM YYYY"))+" ")]),e("td",[t._v(" "+t._s(t._f("uppercase")(o.number))+" ")]),e("td",[e("p-form-input",{attrs:{id:"notes-"+a,name:"notes-"+a,readonly:!0},model:{value:o.notes,callback:function(e){t.$set(o,"notes",e)},expression:"row.notes"}})],1),e("td",[e("p-form-number",{attrs:{id:"available-"+a,name:"available-"+a,readonly:!0,value:o.amount-o.collected}})],1),e("td",[e("p-form-number",{attrs:{id:"amount-"+a,name:"amount-"+a,max:o.amount-o.collected},model:{value:o.toCollect,callback:function(e){t.$set(o,"toCollect",t._n(e))},expression:"row.toCollect"}})],1)])]}))],2),e("point-table",{directives:[{name:"show",rawName:"v-show",value:"down-payment"===t.choosen,expression:"choosen === 'down-payment'"}]},[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",{attrs:{width:"50px"}},[e("p-form-check-box",{staticClass:"text-center",attrs:{id:"subscibe",name:"subscibe",checked:t.isRowsChecked(t.form.references.salesDownPayment,t.checkedRow[1]),"is-form":!1},nativeOn:{click:function(e){return t.toggleCheckRows(1)}}})],1),e("th",[t._v("Date")]),e("th",[t._v("Form Number")]),e("th",[t._v("Notes")]),e("th",[t._v("Available Down Payment")]),e("th",[t._v("Amount Collection")])]),t._l(t.form.references.salesDownPayment,(function(o,a){return[e("tr",{key:a,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[e("p-form-check-box",{staticClass:"text-center",attrs:{id:"subscibe","is-form":!1,name:"subscibe",checked:t.isRowChecked(1,o.id)},nativeOn:{click:function(e){return t.toggleCheckRow(1,o.id)}}})],1),e("td",[t._v(" "+t._s(t._f("dateFormat")(o.date,"DD MMMM YYYY"))+" ")]),e("td",[t._v(" "+t._s(t._f("uppercase")(o.number))+" ")]),e("td",[e("p-form-input",{attrs:{id:"notes-"+a,name:"notes-"+a,readonly:!0},model:{value:o.notes,callback:function(e){t.$set(o,"notes",e)},expression:"row.notes"}})],1),e("td",[e("p-form-number",{attrs:{id:"available-"+a,name:"available-"+a,readonly:!0,value:o.amount-o.collected}})],1),e("td",[e("p-form-number",{attrs:{id:"amount-"+a,name:"amount-"+a,max:o.amount-o.collected},model:{value:o.toCollect,callback:function(e){t.$set(o,"toCollect",t._n(e))},expression:"row.toCollect"}})],1)])]}))],2),e("point-table",{directives:[{name:"show",rawName:"v-show",value:"sales-return"===t.choosen,expression:"choosen === 'sales-return'"}]},[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",{attrs:{width:"50px"}},[e("p-form-check-box",{staticClass:"text-center",attrs:{id:"subscibe",name:"subscibe",checked:t.isRowsChecked(t.form.references.salesReturn,t.checkedRow[2]),"is-form":!1},nativeOn:{click:function(e){return t.toggleCheckRows(2)}}})],1),e("th",[t._v("Date")]),e("th",[t._v("Form Number")]),e("th",[t._v("Notes")]),e("th",[t._v("Available Sales Return")]),e("th",[t._v("Amount Collection")])]),t._l(t.form.references.salesReturn,(function(o,a){return[e("tr",{key:a,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[e("p-form-check-box",{staticClass:"text-center",attrs:{id:"subscibe","is-form":!1,name:"subscibe",checked:t.isRowChecked(2,o.id)},nativeOn:{click:function(e){return t.toggleCheckRow(2,o.id)}}})],1),e("td",[t._v(" "+t._s(t._f("dateFormat")(o.date,"DD MMMM YYYY"))+" ")]),e("td",[t._v(" "+t._s(t._f("uppercase")(o.number))+" ")]),e("td",[e("p-form-input",{attrs:{id:"notes-"+a,name:"notes-"+a,readonly:!0},model:{value:o.notes,callback:function(e){t.$set(o,"notes",e)},expression:"row.notes"}})],1),e("td",[e("p-form-number",{attrs:{id:"available-"+a,name:"available-"+a,readonly:!0,value:o.amount-o.collected}})],1),e("td",[e("p-form-number",{attrs:{id:"amount-"+a,name:"amount-"+a,max:o.amount-o.collected},model:{value:o.toCollect,callback:function(e){t.$set(o,"toCollect",t._n(e))},expression:"row.toCollect"}})],1)])]}))],2),e("point-table",{directives:[{name:"show",rawName:"v-show",value:"other"===t.choosen,expression:"choosen === 'other'"}]},[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",[t._v("#")]),e("th",{staticStyle:{"min-width":"120px"}},[t._v(" Account ")]),e("th",[t._v("Notes")]),e("th",[t._v("Amount")]),e("th",{staticStyle:{"min-width":"120px"}},[t._v(" Allocation ")]),e("th")]),t._l(t.form.others,(function(o,a){return e("tr",{key:a,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[t._v(t._s(a+1))]),e("td",[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.chartOfAccountRef.open(a)}}},[t._v(" "+t._s(t._f("uppercase")(o.chart_of_account_name||t.$t("select")))+" ")])]),e("td",[e("p-form-input",{attrs:{id:"notes-"+a,name:"notes-"+a},model:{value:o.notes,callback:function(e){t.$set(o,"notes",e)},expression:"row.notes"}})],1),e("td",[e("p-form-number",{attrs:{id:"amount-"+a,name:"amount-"+a},nativeOn:{keyup:function(e){return t.calculateOther()}},model:{value:o.amount,callback:function(e){t.$set(o,"amount",e)},expression:"row.amount"}})],1),e("td",[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.allocation.open(a)}}},[t._v(" "+t._s(t._f("uppercase")(o.allocation_name||t.$t("select")))+" ")])]),e("td",[e("i",{staticClass:"btn btn-sm fa fa-times",on:{click:function(e){return t.deleteRowOther(a)}}})])])}))],2),e("button",{directives:[{name:"show",rawName:"v-show",value:"other"===t.choosen,expression:"choosen === 'other'"}],staticClass:"btn btn-sm btn-secondary",attrs:{type:"button"},on:{click:t.addRowOther}},[e("i",{staticClass:"fa fa-plus"}),t._v(" "+t._s(t._f("uppercase")(t.$t("add")))+" ")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-7"}),e("div",{staticClass:"col-sm-5"},[e("point-table",[e("tr",{attrs:{slot:"p-body"},slot:"p-body"},[e("td",[t._v("Total Invoice")]),e("td",[e("p-form-number",{attrs:{id:"total_invoice",name:"total_invoice",readonly:!0,value:t.total_invoice}})],1)]),e("tr",{attrs:{slot:"p-body"},slot:"p-body"},[e("td",[t._v("Total Down Payment")]),e("td",[e("p-form-number",{attrs:{id:"total_down_payment",name:"total_down_payment",readonly:!0,value:t.total_down_payment}})],1)]),e("tr",{attrs:{slot:"p-body"},slot:"p-body"},[e("td",[t._v("Total Return")]),e("td",[e("p-form-number",{attrs:{id:"total_return",name:"total_return",readonly:!0,value:t.total_return}})],1)]),e("tr",{attrs:{slot:"p-body"},slot:"p-body"},[e("td",[t._v("Total Other")]),e("td",[e("p-form-number",{attrs:{id:"total_other",name:"total_other",readonly:!0,min:Number.MIN_SAFE_INTEGER},model:{value:t.form.total_other,callback:function(e){t.$set(t.form,"total_other",t._n(e))},expression:"form.total_other"}})],1)]),e("tr",{attrs:{slot:"p-body"},slot:"p-body"},[e("td",[t._v("Total Amount")]),e("td",[e("p-form-number",{attrs:{id:"total_amount",name:"total_amount",readonly:!0,value:t.total_amount}})],1)])])],1)]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"5",placeholder:"Notes"},domProps:{value:t.form.notes},on:{input:function(e){e.target.composing||t.$set(t.form,"notes",e.target.value)}}})]),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("requested by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" "+t._s(t._f("dateFormat")(Date.now(),"DD MMMM YYYY"))+" ")]),t._v(" "+t._s(t._f("uppercase")(t.requestedBy))+" "),e("div",{staticClass:"d-sm-block d-md-none mt-10"})]),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("approved by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" _______________ ")]),e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.approver.open()}}},[t._v(t._s(t._f("uppercase")(t.form.approver_name||t.$t("select"))))]),e("br"),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(t._f("uppercase")(t.form.approver_email)))])]),e("div",{staticClass:"col-sm-12"},[e("hr"),e("button",{staticClass:"btn btn-block btn-sm btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){return t.openPreview()}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("preview")))+" ")]),e("button",{staticClass:"btn btn-block btn-sm btn-primary",attrs:{type:"submit",disabled:t.isSaving}},[e("i",{directives:[{name:"show",rawName:"v-show",value:t.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),t._v(" "+t._s(t._f("uppercase")(t.$t("save")))+" ")])])])],1):t._e()])],1)],1),e("Coa",{ref:"chartOfAccountRef",on:{choosen:t.onChoosenAccount}}),e("m-user",{ref:"approver",attrs:{permission:"approve sales payment collection"},on:{choosen:function(e){return t.chooseApprover(e)}}}),e("m-allocation",{ref:"allocation",on:{choosen:function(e){return t.chooseAllocation(e)}}}),e("m-customer",{ref:"customers",on:{choosen:t.chooseCustomer}})],1)},n=[],s=o("53ca"),r=o("5530"),i=(o("d3b7"),o("159b"),o("14d9"),o("a434"),o("d81d"),o("e9c4"),o("7db0"),o("b0c0"),o("bea4")),c=o("b047"),l=o.n(c),u=o("5ae6"),m=o("208e"),d=o("feee"),h=o("b7ae"),f=o("d1af"),_=o("2f62"),p={components:{SalesMenu:i["a"],Breadcrumb:u["a"],BreadcrumbSales:m["a"],PointTable:d["a"],Coa:f["a"]},data:function(){return{isSaving:!1,isLoading:!1,isFromPreview:!1,choosen:"invoice",requestedBy:localStorage.getItem("fullName"),checkedRow:[[],[],[]],form:new h["a"]({customer_id:null,customer_name:null,customer_label:null,customer_address:null,customer_phone:null,customer_email:null,references:null,increment_group:this.$moment().format("YYYYMM"),date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),due_date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),payment_type:"cash",request_approval_to:null,approver_name:null,approver_email:null,notes:"",amount:0,total_invoice:0,total_down_payment:0,total_return:0,total_other:0,total_amount:0,others:[{chart_of_account_id:null,chart_of_account_name:null,amount:null,allocation_id:null,allocation_name:null,notes:null,is_debit:0}],details:[{date:null,chart_of_account_id:null,chart_of_account_name:null,available:null,amount:null,allocation_id:null,allocation_name:null,referenceable_form_date:null,referenceable_form_number:null,referenceable_form_notes:null,referenceable_id:null,referenceable_type:null}]})}},computed:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(_["c"])("salesPaymentCollection",["references"])),Object(_["c"])("auth",["authUser"])),{},{total_invoice:function(){var t=this,e=0;return this.form.references.salesInvoice.forEach((function(o){t.isRowChecked(0,o.id)&&(e+=parseFloat(o.toCollect))})),e},total_down_payment:function(){var t=this,e=0;return this.form.references.salesDownPayment.forEach((function(o){t.isRowChecked(1,o.id)&&(e+=parseFloat(o.toCollect))})),e},total_return:function(){var t=this,e=0;return this.form.references.salesReturn.forEach((function(o){t.isRowChecked(2,o.id)&&(e+=parseFloat(o.toCollect))})),e},total_amount:function(){var t=this.total_invoice-this.total_down_payment-this.total_return+parseFloat(this.form.total_other);return t}}),created:function(){this.getDataFromStorage()},methods:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(_["b"])("salesPaymentCollection",["getReferences","create","addHistories"])),Object(_["b"])("salesPaymentCollectionApproval",["sendSingle"])),{},{getDataFromStorage:function(){var t=JSON.parse(localStorage.getItem("paymentCollectionData"));t&&(this.isFromPreview=!0,this.form=new h["a"](t.form),this.checkedRow=t.checkedRow,localStorage.removeItem("paymentCollectionData"))},toggleCheckRow:function(t,e){this.isRowChecked(t,e)?this.checkedRow[t].splice(this.checkedRow[t].map((function(t){return t.id})).indexOf(e),1):this.checkedRow[t].push({id:e})},toggleCheckRows:function(t){var e=this,o=[];0===t?o=this.form.references.salesInvoice:1===t?o=this.form.references.salesDownPayment:2===t&&(o=this.form.references.salesReturn),this.isRowsChecked(o,this.checkedRow[t])?o.forEach((function(o){e.checkedRow[t].splice(e.checkedRow[t].map((function(t){return t.id})).indexOf(o.id),1)})):o.forEach((function(o){if(!e.isRowChecked(t,o.id)){var a=o.id;e.checkedRow[t].push({id:a})}}))},isRowChecked:function(t,e){return this.checkedRow[t].some((function(t){return t.id==e}))},isRowsChecked:function(t,e){if(0==e.length)return!1;for(var o=function(o){var a=e.some((function(e){return e.id==t[o].id}));if(!a)return{v:!1}},a=0;a<t.length;a++){var n=o(a);if("object"===Object(s["a"])(n))return n.v}return!0},getAvailableReference:function(){var t=this;this.isLoading=!0,this.getReferences({id:this.form.customer_id}).then((function(e){0===e.data.salesInvoice.length&&0===e.data.salesDownPayment.length&&0===e.data.salesReturn.length?t.$notification.error("customer doesn't have sales form to collect"):t.form.references=e.data,t.isLoading=!1})).catch((function(e){t.$notification.error(e.message)})).finally((function(){t.isLoading=!1}))},choose:function(t){this.choosen=t},choosePaymentType:function(t){this.form.payment_type=t},openPreview:function(){this.isFromPreview||this.checkedRowToFormDetails(),this.form.amount=this.total_amount,this.form.total_invoice=this.total_invoice,this.form.total_down_payment=this.total_down_payment,this.form.total_return=this.total_return;var t={checkedRow:this.checkedRow,form:this.form};console.log(JSON.stringify(this.form)),localStorage.setItem("paymentCollectionData",JSON.stringify(t)),this.$router.push({name:"sales.payment-collection.preview",params:{source:"create"}})},onChoosenAccount:function(t){var e=this.form.others[t.index];e.chart_of_account_id=t.id,e.chart_of_account_name=t.label,e.is_debit=t.isDebit},checkedRowToFormDetails:function(){var t=this;this.form.others[0].chart_of_account_id&&this.form.others.forEach((function(e){t.form.details.push(e)})),this.checkedRow[0].forEach((function(e){var o=t.form.references.salesInvoice.find((function(t){return t.id===e.id}));o&&t.form.details.push({date:o.date,chart_of_account_id:null,chart_of_account_name:null,available:o.amount-o.collected,amount:o.toCollect,allocation_id:null,allocation_name:null,referenceable_form_date:o.date,referenceable_form_number:o.number,referenceable_form_notes:o.notes,referenceable_id:o.id,referenceable_type:"SalesInvoice"})})),this.checkedRow[1].forEach((function(e){var o=t.form.references.salesDownPayment.find((function(t){return t.id===e.id}));o&&t.form.details.push({date:o.date,chart_of_account_id:null,chart_of_account_name:null,available:o.amount-o.collected,amount:o.toCollect,allocation_id:null,allocation_name:null,referenceable_form_date:o.date,referenceable_form_number:o.number,referenceable_form_notes:o.notes,referenceable_id:o.id,referenceable_type:"SalesDownPayment"})})),this.checkedRow[2].forEach((function(e){var o=t.form.references.salesReturn.find((function(t){return t.id===e.id}));o&&t.form.details.push({date:o.date,chart_of_account_id:null,chart_of_account_name:null,available:o.amount-o.collected,amount:o.toCollect,allocation_id:null,allocation_name:null,referenceable_form_date:o.date,referenceable_form_number:o.number,referenceable_form_notes:o.notes,referenceable_id:o.id,referenceable_type:"SalesReturn"})}))},addRowOther:function(){this.form.others.push({chart_of_account_id:null,chart_of_account_name:null,amount:null,allocation_id:null,allocation_name:null,notes:null})},deleteRowOther:function(t){this.$delete(this.form.others,t),this.calculateOther()},calculateOther:l()((function(){var t=0;this.form.others.forEach((function(e){console.log(JSON.stringify(e)),1===e.is_debit?t-=parseFloat(e.amount):t+=parseFloat(e.amount)})),this.form.total_other=t}),300),chooseAllocation:function(t){var e=this.form.others[t.index];e.allocation_id=t.id,e.allocation_name=t.name},chooseApprover:function(t){this.form.request_approval_to=t.id,this.form.approver_name=t.fullName,this.form.approver_email=t.email},chooseCustomer:function(t){this.form.customer_id=t.id,this.form.customer_name=t.name,this.form.customer_label=t.label,this.form.customer_address=t.address,this.form.customer_phone=t.phone,this.form.customer_email=t.email,this.form.pricing_group_id=t.pricing_group_id,this.getAvailableReference()},onSubmit:function(){var t=this;this.isSaving=!0,this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.amount=this.total_amount;var e=this.total_invoice,o=this.total_down_payment,a=this.total_return,n=this.form.total_other;if(null==this.form.request_approval_to)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({request_approval_to:["Approver should not empty"]});if(this.form.notes){if(this.form.notes.length>255)return this.$notification.error("notes cannot be more than 255 character"),this.isSaving=!1,void this.form.errors.record({notes:["notes cannot be more than 255 character"]});if(" "===this.form.notes.charAt(0)||" "===this.form.notes.charAt(this.form.notes.length-1))return this.$notification.error("notes cannot start or end with space"),this.isSaving=!1,void this.form.errors.record({notes:["notes cannot start or end with space"]})}if(this.form.details=[],this.checkedRowToFormDetails(),0===this.form.details.length)return this.$notification.error("form cannot be empty"),void(this.isSaving=!1);this.create(this.form).then((function(s){t.isSaving=!1,t.$notification.success("create success"),Object.assign(t.$data,t.$options.data.call(t)),t.$router.push("/sales/payment-collection/"+s.data.id),t.sendSingle({id:s.data.id,total_invoice:e,total_down_payment:o,total_return:a,total_other:n}).catch((function(e){t.$notification.error(e.message),t.form.errors.record(e.errors)}))})).catch((function(e){t.isSaving=!1,t.$notification.error(e.message),t.form.errors.record(e.errors)}))}})},b=p,v=o("2877"),y=Object(v["a"])(b,a,n,!1,null,null,null);e["default"]=y.exports},d1af:function(t,e,o){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",[e("sweet-modal",{ref:"modal",attrs:{title:t._f("uppercase")(t.$t("select chart of account")),"overlay-theme":"dark"},on:{close:function(e){return t.onClose()}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search..."},domProps:{value:t.searchText},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()},input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),e("hr"),t.isLoading?e("div",[e("h3",{staticClass:"text-center"},[t._v(" Loading ... ")])]):e("div",{staticClass:"list-group push"},[t._l(t.options,(function(o,a){return[e("a",{key:a,staticClass:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",class:{active:o.id==t.mutableId},attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.choose(o)}}},[t._v(" "+t._s(t._f("uppercase")(o.label))+" ")])]}))],2),t.searchText&&0==t.options.length&&!t.isLoading?e("div",{staticClass:"text-center alert alert-info"},[t._v(" "+t._s(t._f("capitalize")(t.$t("searching not found",[t.searchText])))+" "),e("br")]):t._e(),t.searchText||0!=t.options.length||t.isLoading?t._e():e("div",{staticClass:"text-center alert alert-info"},[t._v(" "+t._s(t._f("capitalize")(t.$t("you don't have any")))+" "+t._s(t._f("capitalize")(t.$t("chart of account")))+", "),e("br"),t._v(" "+t._s(t.$t("you can create"))+" ")]),e("div",{staticClass:"pull-right"},[e("button",{staticClass:"mr-5 btn btn-sm btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){return t.add()}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("add")))+" ")]),e("button",{staticClass:"btn btn-sm btn-outline-danger",attrs:{type:"button"},on:{click:function(e){return t.clear()}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("clear")))+" ")])])])],1)},n=[],s=o("5530"),r=(o("a9e3"),o("ac1f"),o("841c"),o("d81d"),o("14d9"),o("b0c0"),o("b047")),i=o.n(r),c=o("2f62"),l={props:{id:{type:String,default:""},value:{type:[String,Number],default:""},label:{type:String,default:""},type:{type:String,default:""}},data:function(){return{index:null,searchText:"",options:[],mutableId:this.value,mutableLabel:this.label,isSaving:!1,isLoading:!1}},computed:Object(s["a"])({},Object(c["c"])("accountingChartOfAccount",["chartOfAccounts"])),watch:{searchText:i()((function(){this.search()}),300),label:function(){this.mutableLabel=this.label}},created:function(){this.search()},beforeDestroy:function(){this.close()},methods:Object(s["a"])(Object(s["a"])({},Object(c["b"])("accountingChartOfAccount",["get","create"])),{},{search:function(){var t=this;this.isLoading=!0,this.type?this.get({params:{join:"account_type",fields:"account.*",limit:1e3,filter_like:{"account_type.alias":this.searchText,"account.alias":this.searchText,"account.number":this.searchText},includes:"type",sort_by:"account.number;account.alias"}}).then((function(e){t.options=[],t.mutableLabel=null,e.data.map((function(e,o){t.options.push({id:e.id,alias:e.alias,label:e.label,isDebit:e.type.is_debit}),t.value==e.id&&(t.mutableLabel=e.number+" - "+e.alias)})),t.isLoading=!1})).catch((function(e){t.isLoading=!1})):this.get({params:{join:"account_type",fields:"account.*",limit:1e3,filter_like:{"account_type.alias":this.searchText,"account.alias":this.searchText,"account.number":this.searchText},includes:"type",sort_by:"account.number;account.alias"}}).then((function(e){t.options=[],t.mutableLabel=null,e.data.map((function(e,o){"NET INCOME"!==e.type.name.toUpperCase()&&"SALES INCOME"!==e.type.name.toUpperCase()&&"OTHER INCOME"!==e.type.name.toUpperCase()&&"COST OF SALES"!==e.type.name.toUpperCase()&&"DIRECT EXPENSE"!==e.type.name.toUpperCase()&&"OTHER EXPENSE"!==e.type.name.toUpperCase()||t.options.push({id:e.id,alias:e.alias,label:e.label,isDebit:e.type.is_debit}),t.value==e.id&&(t.mutableLabel=e.number+" - "+e.alias)})),t.isLoading=!1})).catch((function(e){t.isLoading=!1}))},add:function(){},choose:function(t){t.index=this.index,this.mutableId=t.id,this.mutableLabel=t.label,this.$emit("input",t.id),this.$emit("choosen",t),this.close()},open:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.index=t,this.$refs.modal.open(),this.search()},close:function(){this.$refs.modal.close()},onClose:function(){this.$emit("close",!0)}})},u=l,m=(o("bb89"),o("2877")),d=Object(m["a"])(u,a,n,!1,null,"13da0b9d",null);e["a"]=d.exports}}]);
//# sourceMappingURL=chunk-373629f6.6d7d6013.js.map
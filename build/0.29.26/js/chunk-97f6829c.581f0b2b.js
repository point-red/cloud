(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-97f6829c"],{"208e":function(t,e,a){"use strict";var s=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales")))+" ")])},o=[],r=a("2877"),i={},n=Object(r["a"])(i,s,o,!1,null,null,null);e["a"]=n.exports},3020:function(t,e,a){"use strict";a("72d2")},"6df4":function(t,e,a){"use strict";a.r(e);a("a9e3");var s=function(){var t=this,e=t._self._c;return e("div",[e("breadcrumb",[e("breadcrumb-sales"),e("router-link",{staticClass:"breadcrumb-item",attrs:{to:"/sales/return"}},[t._v(" "+t._s(t._f("uppercase")(t.$t("sales return")))+" ")]),e("span",{staticClass:"breadcrumb-item active"},[t._v(t._s(t._f("uppercase")(t.$t("create"))))])],1),e("sales-menu"),e("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("div",{staticClass:"row"},[e("p-block",[e("p-block-inner",{attrs:{"is-loading":t.isLoading}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("h4",[t._v(t._s(t._f("uppercase")(t.$t("sales return "))))]),e("table",{staticClass:"table table-sm table-bordered"},[e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("Form number")))+" ")]),e("td",[e("span",[t._v(" "+t._s(t._f("uppercase")(t.salesReturn.form.number))+" ")])])]),e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("date")))+" ")]),e("td",[t._v(" "+t._s(t._f("dateFormat")(t.salesReturn.form.date,"DD MMMM YYYY HH:mm"))+" ")])]),e("tr",[e("td",{staticClass:"font-weight-bold"},[t._v(" "+t._s(t._f("uppercase")(t.$t("reference")))+" ")]),e("td",[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.selectSalesInvoice.open()}}},[t.salesReturn&&null!=t.salesReturn.sales_invoice.form.number?[t._v(" "+t._s(t.salesReturn.sales_invoice.form.number)+" ")]:[t._v(" "+t._s(t._f("uppercase")(t.$t("select")))+" ")]],2)])])])]),e("div",{staticClass:"col-sm-6 text-right"},[e("div",{staticClass:"mb-30"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.authUser.tenant_name))+" ")]),t.authUser.branch?[t._v(" "+t._s(t._f("uppercase")(t.authUser.branch.address))+" "),t.authUser.branch.address?e("br"):t._e(),t._v(" "+t._s(t._f("uppercase")(t.authUser.branch.phone))+" "),t.authUser.branch.phone?e("br"):t._e()]:t._e()],2),e("div",[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("to")))+": "),e("span",[t._v(t._s(t._f("uppercase")(t.form.customer_name)))])]),t._v(" "+t._s(t._f("uppercase")(t.form.customer_address))+" "),t.form.customer_address?e("br"):t._e(),t._v(" "+t._s(t.form.customer_phone)+" "),t.form.customer_phone?e("br"):t._e()])])]),e("hr"),e("point-table",[e("tr",{attrs:{slot:"p-head"},slot:"p-head"},[e("th",[t._v("#")]),e("th",{staticStyle:{"min-width":"120px"}},[t._v(" Item ")]),e("th",[t._v("Allocation")]),e("th",[t._v("Quantity Sales")]),e("th",[t._v("Quantity Return")]),e("th",[t._v("Price Sales")]),e("th",[t._v("Total")])]),t._l(t.form.items,(function(a,s){return[e("tr",{key:s,attrs:{slot:"p-body"},slot:"p-body"},[e("th",[t._v(t._s(s+1))]),e("td",[t._v(" "+t._s(t._f("uppercase")(a.item_name||t.$t("select")))+" ")]),e("td",[e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.allocation.open(s)}}},[t._v(" "+t._s(t._f("uppercase")(a.allocation_name||t.$t("select")))+" ")])]),e("td",[e("p-quantity-custom",{attrs:{id:"quantity"+s,name:"quantity"+s,"item-id":a.item_id,units:a.units,unit:{name:a.unit,label:a.unit,converter:a.converter},disabled:"",readonly:""},model:{value:a.quantity_sales,callback:function(e){t.$set(a,"quantity_sales",e)},expression:"row.quantity_sales"}})],1),e("td",[e("p-quantity-custom",{attrs:{id:"quantity-return"+s,name:"quantity-return"+s,max:Number(a.quantity_sales),"item-id":a.item_id,units:a.units,unit:{name:a.unit,label:a.unit,converter:a.converter}},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"row.quantity"}})],1),e("td",[e("p-form-number",{attrs:{id:"price"+s,name:"price"+s,readonly:!0},model:{value:a.price_sales,callback:function(e){t.$set(a,"price_sales",t._n(e))},expression:"row.price_sales"}})],1),e("td",[e("p-form-number",{attrs:{id:"total-"+s,name:"total-"+s,readonly:!0,value:a.quantity*a.price_sales}})],1)])]}))],2),e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{rows:"14",placeholder:"Notes"},domProps:{value:t.form.notes},on:{input:function(e){e.target.composing||t.$set(t.form,"notes",e.target.value)}}})]),e("div",{staticClass:"col-sm-6"},[e("p-form-row",{attrs:{id:"sub_total",name:"sub_total",label:t.$t("sub total")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"sub_total",name:"sub_total",readonly:!0,value:t.sub_total}})],1)]),e("p-form-row",{attrs:{id:"tax_base",name:"tax_base",label:t.$t("tax base")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"tax_base",name:"tax_base",readonly:!0,value:t.tax_base}})],1)]),e("p-form-row",{attrs:{name:"tax",label:t.$t("tax method")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[t._v(" "+t._s(t._f("uppercase")(t.form.type_of_tax+" tax"))+" ")])]),e("p-form-row",{attrs:{id:"tax_amount",name:"tax_amount",label:t.$t("tax amount")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"tax_amount",name:"tax_amount",readonly:!0,value:t.tax_amount}})],1)]),e("p-form-row",{attrs:{id:"amount",name:"amount",label:t.$t("amount")}},[e("div",{staticClass:"col-lg-9 mt-5",attrs:{slot:"body"},slot:"body"},[e("p-form-number",{attrs:{id:"amount",name:"amount",readonly:!0,value:t.amount}})],1)])],1)]),e("hr"),e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-6"}),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("requested by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" "+t._s(t._f("dateFormat")(Date.now(),"DD MMMM YYYY"))+" ")]),t._v(" "+t._s(t._f("uppercase")(t.requestedBy))+" "),e("div",{staticClass:"d-sm-block d-md-none mt-10"})]),e("div",{staticClass:"col-sm-3 text-center"},[e("h6",{staticClass:"mb-0"},[t._v(" "+t._s(t._f("uppercase")(t.$t("approved by")))+" ")]),e("div",{staticClass:"mb-50",staticStyle:{"font-size":"11px"}},[t._v(" _______________ ")]),e("span",{staticClass:"select-link",on:{click:function(e){return t.$refs.approver.open()}}},[t._v(t._s(t._f("uppercase")(t.form.approver_name||t.$t("select"))))]),e("br"),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(t._f("uppercase")(t.form.approver_email)))])]),e("div",{staticClass:"col-sm-12"},[e("hr"),e("button",{staticClass:"btn btn-block btn-sm btn-primary",attrs:{type:"submit",disabled:t.isSaving}},[e("i",{directives:[{name:"show",rawName:"v-show",value:t.isSaving,expression:"isSaving"}],staticClass:"fa fa-asterisk fa-spin"}),t._v(" "+t._s(t._f("uppercase")(t.$t("save")))+" ")])])])],1)],1)],1)]),e("m-user",{ref:"approver",attrs:{permission:"approve sales return"},on:{choosen:t.chooseApprover}}),e("m-allocation",{ref:"allocation",on:{choosen:function(e){return t.chooseAllocation(e)}}}),e("select-sales-invoice",{ref:"selectSalesInvoice",on:{choosen:t.chooseSalesInvoice}})],1)},o=[],r=a("5530"),i=(a("13d5"),a("d3b7"),a("7db0"),a("d81d"),a("159b"),a("14d9"),a("b0c0"),a("4de4"),a("bea4")),n=a("5ae6"),l=a("208e"),c=a("b7ae"),u=a("feee"),m=a("a832"),_=a("2f62"),d={components:{SalesMenu:i["a"],Breadcrumb:n["a"],BreadcrumbSales:l["a"],SelectSalesInvoice:m["a"],PointTable:u["a"]},data:function(){return{id:this.$route.params.id,isSaving:!1,isLoading:!1,requestedBy:localStorage.getItem("fullName"),salesInvoice:null,form:new c["a"]({id:this.$route.params.id,increment_group:this.$moment().format("YYYYMM"),date:this.$moment().format("YYYY-MM-DD HH:mm:ss"),sales_invoice_id:null,warehouse_id:null,customer_id:null,customer_code:null,customer_name:null,customer_address:null,customer_phone:null,customer_email:null,notes:null,type_of_tax:null,tax:null,amount:null,request_approval_to:null,approver_name:null,approver_email:null,items:[]})}},computed:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(_["c"])("salesReturn",["salesReturn"])),Object(_["c"])("auth",["authUser"])),{},{sub_total:function(){return this.form.items.reduce((function(t,e){return t+e.quantity*e.price_sales}),0)},tax_base:function(){return this.sub_total},tax_amount:function(){var t=0;return"include"==this.form.type_of_tax?t=this.tax_base-10*this.tax_base/11:"exclude"==this.form.type_of_tax&&(t=this.tax_base/10),t},amount:function(){return"include"==this.form.type_of_tax?this.sub_total:this.sub_total+this.tax_amount}}),created:function(){var t=this;this.$permission.has("update sales return")?(this.isLoading=!0,this.find({id:this.$route.params.id,params:{includes:"customer;items.item;items.allocation;items.salesInvoiceItem;salesInvoice.form;salesInvoice.items;form.createdBy;form.requestApprovalTo;form.branch"}}).then((function(e){t.isLoading=!1,t.form.sales_invoice_id=e.data.sales_invoice_id,t.form.date=e.data.form.date,t.form.warehouse_id=e.data.warehouse_id,t.form.customer_id=e.data.customer_id,t.form.customer_name=e.data.customer_name,t.form.customer_address=e.data.customer.address,t.form.customer_phone=e.data.customer.phone,t.form.customer_email=e.data.customer.email,t.form.notes=e.data.form.notes,t.form.type_of_tax=e.data.sales_invoice.type_of_tax,t.form.amount=e.data.amount,t.form.tax=e.data.tax,t.form.items=e.data.sales_invoice.items.map((function(t){return{sales_invoice_item_id:t.id,item_id:t.item_id,item_name:t.item_name,item_label:t.item_name,more:!1,unit:t.unit_smallest||t.unit,converter:t.converter_smallest||t.converter,expiry_date:t.expiry_date,production_number:t.production_number,quantity_sales:t.quantity-t.quantity_returned,quantity:0,price:t.price,price_sales:t.price-t.discount_value,discount_percent:t.discount_percent,discount_value:t.discount_value,total:t.quantity*(t.price-t.discount_value),allocation_id:t.allocation_id,allocation_name:t.allocation_name,notes:t.notes}})),t.form.request_approval_to=e.data.form.request_approval_to.id,t.form.approver_name=e.data.form.request_approval_to.full_name,t.form.approver_email=e.data.form.request_approval_to.email,t.form.items.forEach((function(t){e.data.items.forEach((function(a){t.item_id===a.item_id&&(t.quantity_before=a.quantity,t.quantity=a.quantity,1===e.data.form.approval_status&&(t.quantity_sales+=a.quantity))}))}))})).catch((function(e){t.isLoading=!1,t.$notification.error(e.message)}))):this.$router.push("/")},methods:Object(r["a"])(Object(r["a"])({},Object(_["b"])("salesReturn",["find","update"])),{},{chooseSalesInvoice:function(t){this.salesInvoice=t,this.form.sales_invoice_id=t.id,this.form.warehouse_id=t.salesDeliveryNote.warehouseId,this.form.customer_id=t.customerId,this.form.customer_code=t.customerCode,this.form.customer_name=t.customerName,this.form.type_of_tax=t.typeOfTax,this.form.items=t.items.map((function(t){return{sales_invoice_item_id:t.id,item_id:t.itemId,item_name:t.itemName,item_label:t.itemName,more:!1,units:t.units,unit:t.unit_smallest||t.unit,converter:t.converter_smallest||t.converter,expiry_date:t.expiryDate,production_number:t.productionNumber,quantity_sales:t.quantity-t.quantityReturned,quantity:0,price:t.price,price_sales:t.price-t.discountValue,discount_percent:t.discountPercent,discount_value:t.discountValue,total:t.quantity*(t.price-t.discountValue),allocation_id:t.allocation_id,allocation_name:t.allocation_name,notes:t.notes}}))},chooseAllocation:function(t){var e=this.form.items[t.index];e.allocation_id=t.id,e.allocation_name=t.name},chooseApprover:function(t){this.form.request_approval_to=t.id,this.form.approver_name=t.fullName,this.form.approver_email=t.email},onSubmit:function(){var t=this;if(this.isSaving=!0,this.form.notes){if(this.form.notes.length>255)return this.$notification.error("notes cannot be more than 255 character"),this.isSaving=!1,void this.form.errors.record({notes:["notes cannot be more than 255 character"]});if(" "===this.form.notes.charAt(0)||" "===this.form.notes.charAt(this.form.notes.length-1))return this.$notification.error("notes cannot start or end with space"),this.isSaving=!1,void this.form.errors.record({notes:["notes cannot start or end with space"]})}if(null==this.form.request_approval_to)return this.$notification.error("approval cannot be null"),this.isSaving=!1,void this.form.errors.record({request_approval_to:["Approver should not empty"]});this.form.increment_group=this.$moment(this.form.date).format("YYYYMM"),this.form.amount=this.amount,this.form.tax=this.tax_amount,this.form.items=this.form.items.filter((function(t){if(t.quantity>0)return t})),this.update(this.form).then((function(e){t.isSaving=!1,t.$notification.success("update success"),Object.assign(t.$data,t.$options.data.call(t)),t.$router.push("/sales/return/"+e.data.id)})).catch((function(e){t.isSaving=!1,t.$notification.error(e.message),t.form.errors.record(e.errors)}))}})},p=d,f=a("2877"),h=Object(f["a"])(p,s,o,!1,null,null,null);e["default"]=h.exports},"72d2":function(t,e,a){},a832:function(t,e,a){"use strict";var s=function(){var t=this,e=t._self._c;return e("sweet-modal",{ref:"modal",attrs:{title:t._f("uppercase")("Select Sales Invoice"),"overlay-theme":"dark"},on:{close:function(e){return t.onClose()}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search..."},domProps:{value:t.searchText},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()},input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),e("hr"),t.isLoading?e("div",[e("h3",{staticClass:"text-center"},[t._v(" Loading ... ")])]):e("div",{staticClass:"list-group push table-responsive"},[e("table",{staticClass:"table table-sm"},[e("tr",[e("th",[t._v("Date")]),e("th",[t._v("Sales Invoice")]),e("th",[t._v("Customer")]),e("th",[t._v("Item")]),e("th",[t._v("Quantity")]),e("th",[t._v("Price")])]),t._l(t.options,(function(a,s){return[e("tbody",{key:"request-"+s,staticClass:"cursor-pointer hover-active",attrs:{slot:"p-body"},on:{click:function(e){return t.choose(a)}},slot:"p-body"},[t._l(a.items,(function(o,r){return[o.quantityRemaining>0?e("tr",{key:"request-"+s+"-"+r},[e("td",[t._v(t._s(0===r?"".concat(t.$options.filters.dateFormat(a.form.date,"DD MMMM YYYY")):null))]),e("td",[t._v(t._s(0===r?a.form.number:null))]),e("td",[t._v(t._s(0===r?a.customerName:null))]),e("td",[t._v(t._s(o.itemName))]),e("td",[t._v(t._s(o.quantityRemaining))]),e("td",[t._v(t._s(o.price-o.discountValue))])]):t._e()]}))],2)]}))],2),e("p-pagination",{attrs:{"current-page":t.currentPage,"last-page":t.lastPage},on:{updatePage:t.updatePage}})],1),t.searchText&&0==t.options.length&&!t.isLoading?e("div",{staticClass:"alert alert-info text-center"},[t._v(" "+t._s(t._f("capitalize")(t.$t("searching not found",[t.searchText])))+" ")]):t._e(),e("div",{staticClass:"pull-right"},[e("button",{staticClass:"btn btn-sm btn-outline-danger",attrs:{type:"button"},on:{click:function(e){return t.clear()}}},[t._v(" "+t._s(t._f("uppercase")(t.$t("clear")))+" ")])])])},o=[],r=a("5530"),i=(a("a9e3"),a("ac1f"),a("841c"),a("d3b7"),a("b047")),n=a.n(i),l=a("2f62"),c={props:{id:{type:String,default:""},value:{type:[String,Number],default:""}},data:function(){return{index:null,searchText:"",currentPage:1,lastPage:1,options:[],selected:{},isLoading:!1}},watch:{searchText:n()((function(){this.currentPage=1,this.search()}),300)},methods:Object(r["a"])(Object(r["a"])({},Object(l["b"])("salesInvoice",["get"])),{},{search:function(){var t=this;this.isLoading=!0,this.get({params:{filter_like:{"form.number":this.searchText,"form.created_at":this.searchText,"customer.name":this.searchText,"items.item_name":this.searchText},filter_form:"pending;null",limit:10,page:this.currentPage}}).then((function(e){t.options=e.data,t.lastPage=e.meta.last_page})).finally((function(){t.isLoading=!1}))},clear:function(t){this.$emit("choosen",{id:null,form:{number:null}}),this.close()},choose:function(t){this.$emit("choosen",t),this.close()},open:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.index=t,this.search(),this.$refs.modal.open()},close:function(){this.$refs.modal.close()},onClose:function(){this.searchText="",this.$emit("close",!0)},updatePage:function(t){this.currentPage=t,this.search()}})},u=c,m=(a("3020"),a("2877")),_=Object(m["a"])(u,s,o,!1,null,"522602b8",null);e["a"]=_.exports}}]);
//# sourceMappingURL=chunk-97f6829c.581f0b2b.js.map